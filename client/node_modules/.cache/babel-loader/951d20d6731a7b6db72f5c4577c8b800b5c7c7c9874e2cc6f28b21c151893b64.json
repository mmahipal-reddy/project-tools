{"ast":null,"code":"import{useState,useCallback}from'react';import axios from'axios';import toast from'react-hot-toast';const reportApiClient=axios.create({baseURL:process.env.REACT_APP_API_URL||'/api',headers:{'Content-Type':'application/json'},timeout:120000// 2 minutes for preview\n});reportApiClient.interceptors.request.use(config=>{const token=localStorage.getItem('token');if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;});export const usePreview=()=>{const[previewData,setPreviewData]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const generatePreview=useCallback(async reportConfig=>{if(!reportConfig){setPreviewData(null);return;}// Check if multi-object mode or legacy single-object mode\nconst isMultiObjectMode=reportConfig.objects&&reportConfig.objects.length>0;// Validate multi-object mode\nif(isMultiObjectMode){// Filter out objects with no fields before sending\nconst objectsWithFields=reportConfig.objects.filter(obj=>{const fields=obj.fields||[];return fields.length>0;});if(objectsWithFields.length===0){setPreviewData(null);return;}}else{// Legacy single-object mode: validate required fields\nif(!reportConfig.objectType||!reportConfig.fields||reportConfig.fields.length===0){setPreviewData(null);return;}}setLoading(true);setError(null);try{if(isMultiObjectMode){// Multi-object mode: send objects array\nconst objectsWithFields=reportConfig.objects.filter(obj=>{const fields=obj.fields||[];return fields.length>0;});const objects=objectsWithFields.map(obj=>({objectType:obj.objectType,fields:(obj.fields||[]).map(f=>typeof f==='string'?f:(f===null||f===void 0?void 0:f.name)||f),filters:obj.filters&&obj.filters.length>0?{groups:[{id:'group_1',logic:'AND',conditions:(obj.filters||[]).map(filter=>({field:(filter===null||filter===void 0?void 0:filter.field)||'',operator:(filter===null||filter===void 0?void 0:filter.operator)||'equals',value:(filter===null||filter===void 0?void 0:filter.value)||''}))}],groupLogic:'AND'}:{},relationships:obj.relationships||[],subqueries:obj.subqueries||[]}));const response=await reportApiClient.post('/reports/preview-multi',{objects,sortBy:reportConfig.sortBy,sortOrder:reportConfig.sortOrder,groupBy:reportConfig.groupBy,limit:reportConfig.limit||10000});if(response.data.success){setPreviewData(response.data.records||[]);}else{setError(response.data.error||'Failed to preview report');toast.error(response.data.error||'Failed to preview report');}}else{// Legacy single-object mode\nconst fields=(reportConfig.fields||[]).map(f=>typeof f==='string'?f:(f===null||f===void 0?void 0:f.name)||f);// Double-check we have required data before calling API\nif(!reportConfig.objectType||!fields||fields.length===0){console.log('[Preview] Skipping legacy preview - missing data:',{hasObjectType:!!reportConfig.objectType,objectType:reportConfig.objectType,fieldsCount:fields?fields.length:0,fields:fields});setPreviewData(null);setLoading(false);return;}const filters=reportConfig.filters&&reportConfig.filters.length>0?{groups:[{id:'group_1',logic:'AND',conditions:(reportConfig.filters||[]).map(filter=>({field:(filter===null||filter===void 0?void 0:filter.field)||'',operator:(filter===null||filter===void 0?void 0:filter.operator)||'equals',value:(filter===null||filter===void 0?void 0:filter.value)||''}))}],groupLogic:'AND'}:{};// Final validation before API call\nif(!reportConfig.objectType||!fields||fields.length===0){console.warn('[Preview] Skipping preview - missing objectType or fields:',{objectType:reportConfig.objectType,fieldsCount:fields.length});setPreviewData(null);setLoading(false);return;}const response=await reportApiClient.post('/reports/preview',{objectType:reportConfig.objectType,fields,filters,sortBy:reportConfig.sortBy,sortOrder:reportConfig.sortOrder,groupBy:reportConfig.groupBy,limit:reportConfig.limit});if(response.data.success){setPreviewData(response.data.records||[]);}else{setError(response.data.error||'Failed to preview report');toast.error(response.data.error||'Failed to preview report');}}}catch(err){var _err$response,_err$response$data;const errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||err.message||'Failed to preview report';setError(errorMessage);toast.error(errorMessage);setPreviewData(null);}finally{setLoading(false);}},[]);return{previewData,loading,error,generatePreview};};","map":{"version":3,"names":["useState","useCallback","axios","toast","reportApiClient","create","baseURL","process","env","REACT_APP_API_URL","headers","timeout","interceptors","request","use","config","token","localStorage","getItem","Authorization","concat","usePreview","previewData","setPreviewData","loading","setLoading","error","setError","generatePreview","reportConfig","isMultiObjectMode","objects","length","objectsWithFields","filter","obj","fields","objectType","map","f","name","filters","groups","id","logic","conditions","field","operator","value","groupLogic","relationships","subqueries","response","post","sortBy","sortOrder","groupBy","limit","data","success","records","console","log","hasObjectType","fieldsCount","warn","err","_err$response","_err$response$data","errorMessage","message"],"sources":["/Users/mmoola/Cursor/ProjectSetup/client/src/components/AdvancedReportBuilder/hooks/usePreview.js"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\n\nconst reportApiClient = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || '/api',\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  timeout: 120000, // 2 minutes for preview\n});\n\nreportApiClient.interceptors.request.use((config) => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\nexport const usePreview = () => {\n  const [previewData, setPreviewData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const generatePreview = useCallback(async (reportConfig) => {\n    if (!reportConfig) {\n      setPreviewData(null);\n      return;\n    }\n\n    // Check if multi-object mode or legacy single-object mode\n    const isMultiObjectMode = reportConfig.objects && reportConfig.objects.length > 0;\n    \n    // Validate multi-object mode\n    if (isMultiObjectMode) {\n      // Filter out objects with no fields before sending\n      const objectsWithFields = reportConfig.objects.filter(obj => {\n        const fields = obj.fields || [];\n        return fields.length > 0;\n      });\n\n      if (objectsWithFields.length === 0) {\n        setPreviewData(null);\n        return;\n      }\n    } else {\n      // Legacy single-object mode: validate required fields\n      if (!reportConfig.objectType || !reportConfig.fields || reportConfig.fields.length === 0) {\n        setPreviewData(null);\n        return;\n      }\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      if (isMultiObjectMode) {\n        // Multi-object mode: send objects array\n        const objectsWithFields = reportConfig.objects.filter(obj => {\n          const fields = obj.fields || [];\n          return fields.length > 0;\n        });\n\n        const objects = objectsWithFields.map(obj => ({\n          objectType: obj.objectType,\n          fields: (obj.fields || []).map(f => typeof f === 'string' ? f : (f?.name || f)),\n          filters: (obj.filters && obj.filters.length > 0) ? {\n            groups: [{\n              id: 'group_1',\n              logic: 'AND',\n              conditions: (obj.filters || []).map(filter => ({\n                field: filter?.field || '',\n                operator: filter?.operator || 'equals',\n                value: filter?.value || ''\n              }))\n            }],\n            groupLogic: 'AND'\n          } : {},\n          relationships: obj.relationships || [],\n          subqueries: obj.subqueries || []\n        }));\n\n        const response = await reportApiClient.post('/reports/preview-multi', {\n          objects,\n          sortBy: reportConfig.sortBy,\n          sortOrder: reportConfig.sortOrder,\n          groupBy: reportConfig.groupBy,\n          limit: reportConfig.limit || 10000\n        });\n\n        if (response.data.success) {\n          setPreviewData(response.data.records || []);\n        } else {\n          setError(response.data.error || 'Failed to preview report');\n          toast.error(response.data.error || 'Failed to preview report');\n        }\n      } else {\n        // Legacy single-object mode\n        const fields = (reportConfig.fields || []).map(f => typeof f === 'string' ? f : (f?.name || f));\n\n        // Double-check we have required data before calling API\n        if (!reportConfig.objectType || !fields || fields.length === 0) {\n          console.log('[Preview] Skipping legacy preview - missing data:', {\n            hasObjectType: !!reportConfig.objectType,\n            objectType: reportConfig.objectType,\n            fieldsCount: fields ? fields.length : 0,\n            fields: fields\n          });\n          setPreviewData(null);\n          setLoading(false);\n          return;\n        }\n\n        const filters = (reportConfig.filters && reportConfig.filters.length > 0) ? {\n          groups: [{\n            id: 'group_1',\n            logic: 'AND',\n            conditions: (reportConfig.filters || []).map(filter => ({\n              field: filter?.field || '',\n              operator: filter?.operator || 'equals',\n              value: filter?.value || ''\n            }))\n          }],\n          groupLogic: 'AND'\n        } : {};\n\n        // Final validation before API call\n        if (!reportConfig.objectType || !fields || fields.length === 0) {\n          console.warn('[Preview] Skipping preview - missing objectType or fields:', {\n            objectType: reportConfig.objectType,\n            fieldsCount: fields.length\n          });\n          setPreviewData(null);\n          setLoading(false);\n          return;\n        }\n\n        const response = await reportApiClient.post('/reports/preview', {\n          objectType: reportConfig.objectType,\n          fields,\n          filters,\n          sortBy: reportConfig.sortBy,\n          sortOrder: reportConfig.sortOrder,\n          groupBy: reportConfig.groupBy,\n          limit: reportConfig.limit\n        });\n\n        if (response.data.success) {\n          setPreviewData(response.data.records || []);\n        } else {\n          setError(response.data.error || 'Failed to preview report');\n          toast.error(response.data.error || 'Failed to preview report');\n        }\n      }\n    } catch (err) {\n      const errorMessage = err.response?.data?.error || err.message || 'Failed to preview report';\n      setError(errorMessage);\n      toast.error(errorMessage);\n      setPreviewData(null);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  return {\n    previewData,\n    loading,\n    error,\n    generatePreview\n  };\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}