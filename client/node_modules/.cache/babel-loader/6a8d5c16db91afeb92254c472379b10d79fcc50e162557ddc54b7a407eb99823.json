{"ast":null,"code":"import axios from'axios';// In development, use relative URL to go through proxy (avoids CORS)\n// In production, use full URL from environment variable\nconst API_BASE_URL=process.env.REACT_APP_API_URL||(process.env.NODE_ENV==='production'?'/api':'/api');// Backend health check with retry logic\nlet backendHealthCheckPromise=null;let lastHealthCheck=null;const HEALTH_CHECK_CACHE_MS=5000;// Cache health check for 5 seconds\nconst checkBackendHealthWithCache=async()=>{const now=Date.now();// Return cached result if available and recent\nif(lastHealthCheck&&now-lastHealthCheck.timestamp<HEALTH_CHECK_CACHE_MS){return lastHealthCheck.isHealthy;}// If a health check is already in progress, wait for it\nif(backendHealthCheckPromise){return backendHealthCheckPromise;}// Start new health check\nbackendHealthCheckPromise=(async()=>{try{const response=await axios.get('/health',{baseURL:API_BASE_URL,timeout:3000,validateStatus:status=>status===200});lastHealthCheck={isHealthy:true,timestamp:now};return true;}catch(error){lastHealthCheck={isHealthy:false,timestamp:now};return false;}finally{backendHealthCheckPromise=null;}})();return backendHealthCheckPromise;};// CSRF token management\nlet csrfToken=null;let csrfTokenPromise=null;const getCsrfToken=async()=>{// Return cached token if available\nif(csrfToken){return csrfToken;}// If a token fetch is already in progress, wait for it\nif(csrfTokenPromise){return csrfTokenPromise;}// Fetch new CSRF token\ncsrfTokenPromise=(async()=>{try{const response=await axios.get('/csrf-token',{baseURL:API_BASE_URL,timeout:5000});csrfToken=response.data.csrfToken;return csrfToken;}catch(error){console.warn('Failed to fetch CSRF token:',error);// Return null if token fetch fails (will retry on next request)\nreturn null;}finally{csrfTokenPromise=null;}})();return csrfTokenPromise;};// Create axios instance with default config\nconst apiClient=axios.create({baseURL:API_BASE_URL,headers:{'Content-Type':'application/json'},// Remove withCredentials to avoid CORS issues - server CORS is configured correctly\n// withCredentials: true,\ntimeout:120000// 120 second timeout (increased for Salesforce API calls, especially KPIs)\n});// Request interceptor to add auth token and CSRF token\napiClient.interceptors.request.use(async config=>{var _config$url,_config$method;const token=localStorage.getItem('token');if(token){config.headers.Authorization=\"Bearer \".concat(token);}// Add CSRF token for state-changing requests (POST, PUT, DELETE, PATCH)\n// Skip CSRF for auth endpoints and GET requests\nif(!((_config$url=config.url)!==null&&_config$url!==void 0&&_config$url.includes('/auth/'))&&['POST','PUT','DELETE','PATCH'].includes((_config$method=config.method)===null||_config$method===void 0?void 0:_config$method.toUpperCase())){try{const csrf=await getCsrfToken();if(csrf){config.headers['X-CSRF-Token']=csrf;}}catch(error){console.warn('Failed to get CSRF token for request:',error);}}// Always log request details in development for debugging\nif(process.env.NODE_ENV==='development'){console.log('API Request:',{url:config.url,method:config.method,baseURL:config.baseURL,fullURL:\"\".concat(config.baseURL).concat(config.url),hasToken:!!token,hasCsrfToken:!!config.headers['X-CSRF-Token'],tokenLength:token?token.length:0,headers:{'Content-Type':config.headers['Content-Type'],'Authorization':config.headers.Authorization?'Bearer ***':'None','X-CSRF-Token':config.headers['X-CSRF-Token']?'***':'None','Origin':window.location.origin},withCredentials:config.withCredentials});}else if(!token){console.warn('API Request without token:',{url:config.url,method:config.method});}return config;},error=>{console.error('Request interceptor error:',error);return Promise.reject(error);});// Use the cached health check function\nconst checkBackendHealth=checkBackendHealthWithCache;// Export health check function for use in other modules\nexport{checkBackendHealth};// Response interceptor for error handling\napiClient.interceptors.response.use(response=>response,async error=>{var _error$response,_error$response3,_error$response4,_error$response5,_error$response5$data,_error$response5$data2,_error$response6;// Handle 504 Gateway Timeout errors\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===504||error.code==='ECONNREFUSED'||error.code==='ETIMEDOUT'){var _error$config,_error$response2;const url=((_error$config=error.config)===null||_error$config===void 0?void 0:_error$config.url)||'';console.error('Backend connection error:',{status:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status,code:error.code,message:error.message,url:url});error.message='Backend server is not responding. Please ensure the server is running on port 5000.';error.isBackendDown=true;error.userMessage='Unable to connect to server. Please ensure the backend server is running on port 5000.';}// Handle 404 errors - check if backend is ready\nif(((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===404){var _error$config2;const url=((_error$config2=error.config)===null||_error$config2===void 0?void 0:_error$config2.url)||'';const isAuthEndpoint=url.includes('/auth/');// For auth endpoints, check if backend is ready\nif(isAuthEndpoint){const isHealthy=await checkBackendHealth();if(!isHealthy){console.error('Backend is not responding. Please ensure the server is running on port 5000.');error.message='Backend server is not responding. Please ensure the server is running on port 5000.';error.isBackendDown=true;}else{console.error('404 on auth endpoint - route may not be registered:',url);error.message=\"Route not found: \".concat(url,\". Please check that the backend server has restarted and routes are registered.\");}}}// Handle network errors (server not running, CORS blocked, etc.)\nif(!error.response){var _error$config3,_error$config4;const url=((_error$config3=error.config)===null||_error$config3===void 0?void 0:_error$config3.url)||'';const baseURL=((_error$config4=error.config)===null||_error$config4===void 0?void 0:_error$config4.baseURL)||API_BASE_URL;const fullURL=\"\".concat(baseURL).concat(url);console.error('Network error - request did not reach server:',{url:url,fullURL:fullURL,baseURL:baseURL,message:error.message,code:error.code,name:error.name});// Check if it's a CORS error\nif(error.message&&(error.message.includes('CORS')||error.message.includes('Network Error')||error.code==='ERR_NETWORK'||error.code==='ERR_BLOCKED_BY_CLIENT')){console.error('CORS or network blocking detected. Check:');console.error('1. Server is running on port 5000');console.error('2. CORS is configured correctly on server');console.error('3. Browser is not blocking the request');console.error('4. Request URL:',fullURL);}const isAuthEndpoint=url.includes('/auth/');// For login/verify endpoints, provide helpful error message\nif(isAuthEndpoint&&(url.includes('/login')||url.includes('/verify'))){// Don't show error toast for network errors on login - let the component handle it\n// The error will be caught in the login function and shown there\n}return Promise.reject(error);}// Handle CSRF token errors - refresh token and retry\nif(((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===403&&(_error$response5=error.response)!==null&&_error$response5!==void 0&&(_error$response5$data=_error$response5.data)!==null&&_error$response5$data!==void 0&&(_error$response5$data2=_error$response5$data.error)!==null&&_error$response5$data2!==void 0&&_error$response5$data2.includes('CSRF')){// Clear cached CSRF token and retry once\ncsrfToken=null;const originalRequest=error.config;// Only retry if we haven't already retried\nif(!originalRequest._retry){originalRequest._retry=true;try{const newCsrfToken=await getCsrfToken();if(newCsrfToken&&originalRequest.headers){originalRequest.headers['X-CSRF-Token']=newCsrfToken;return apiClient(originalRequest);}}catch(csrfError){console.error('Failed to refresh CSRF token:',csrfError);}}}if(((_error$response6=error.response)===null||_error$response6===void 0?void 0:_error$response6.status)===401){var _error$config5;// Check if this is a Salesforce endpoint error (invalid Salesforce credentials)\n// vs an auth endpoint error (invalid user token)\nconst url=((_error$config5=error.config)===null||_error$config5===void 0?void 0:_error$config5.url)||'';const isSalesforceEndpoint=url.includes('/salesforce/');const isAuthEndpoint=url.includes('/auth/');// Only redirect to login if it's an auth endpoint error (user token invalid)\n// Salesforce 401 errors should not redirect - they're just invalid Salesforce credentials\nif(isAuthEndpoint&&!isSalesforceEndpoint){// Token expired or invalid - redirect to login\nlocalStorage.removeItem('token');window.location.href='/login';}// For Salesforce endpoints, just return the error without redirecting\n}return Promise.reject(error);});export default apiClient;","map":{"version":3,"names":["axios","API_BASE_URL","process","env","REACT_APP_API_URL","NODE_ENV","backendHealthCheckPromise","lastHealthCheck","HEALTH_CHECK_CACHE_MS","checkBackendHealthWithCache","now","Date","timestamp","isHealthy","response","get","baseURL","timeout","validateStatus","status","error","csrfToken","csrfTokenPromise","getCsrfToken","data","console","warn","apiClient","create","headers","interceptors","request","use","config","_config$url","_config$method","token","localStorage","getItem","Authorization","concat","url","includes","method","toUpperCase","csrf","log","fullURL","hasToken","hasCsrfToken","tokenLength","length","window","location","origin","withCredentials","Promise","reject","checkBackendHealth","_error$response","_error$response3","_error$response4","_error$response5","_error$response5$data","_error$response5$data2","_error$response6","code","_error$config","_error$response2","message","isBackendDown","userMessage","_error$config2","isAuthEndpoint","_error$config3","_error$config4","name","originalRequest","_retry","newCsrfToken","csrfError","_error$config5","isSalesforceEndpoint","removeItem","href"],"sources":["/Users/mmoola/Cursor/ProjectSetup/client/src/config/api.js"],"sourcesContent":["import axios from 'axios';\n\n// In development, use relative URL to go through proxy (avoids CORS)\n// In production, use full URL from environment variable\nconst API_BASE_URL = process.env.REACT_APP_API_URL || (process.env.NODE_ENV === 'production' ? '/api' : '/api');\n\n// Backend health check with retry logic\nlet backendHealthCheckPromise = null;\nlet lastHealthCheck = null;\nconst HEALTH_CHECK_CACHE_MS = 5000; // Cache health check for 5 seconds\n\nconst checkBackendHealthWithCache = async () => {\n  const now = Date.now();\n  \n  // Return cached result if available and recent\n  if (lastHealthCheck && (now - lastHealthCheck.timestamp) < HEALTH_CHECK_CACHE_MS) {\n    return lastHealthCheck.isHealthy;\n  }\n  \n  // If a health check is already in progress, wait for it\n  if (backendHealthCheckPromise) {\n    return backendHealthCheckPromise;\n  }\n  \n  // Start new health check\n  backendHealthCheckPromise = (async () => {\n    try {\n      const response = await axios.get('/health', {\n        baseURL: API_BASE_URL,\n        timeout: 3000,\n        validateStatus: (status) => status === 200\n      });\n      lastHealthCheck = { isHealthy: true, timestamp: now };\n      return true;\n    } catch (error) {\n      lastHealthCheck = { isHealthy: false, timestamp: now };\n      return false;\n    } finally {\n      backendHealthCheckPromise = null;\n    }\n  })();\n  \n  return backendHealthCheckPromise;\n};\n\n// CSRF token management\nlet csrfToken = null;\nlet csrfTokenPromise = null;\n\nconst getCsrfToken = async () => {\n  // Return cached token if available\n  if (csrfToken) {\n    return csrfToken;\n  }\n  \n  // If a token fetch is already in progress, wait for it\n  if (csrfTokenPromise) {\n    return csrfTokenPromise;\n  }\n  \n  // Fetch new CSRF token\n  csrfTokenPromise = (async () => {\n    try {\n      const response = await axios.get('/csrf-token', {\n        baseURL: API_BASE_URL,\n        timeout: 5000\n      });\n      csrfToken = response.data.csrfToken;\n      return csrfToken;\n    } catch (error) {\n      console.warn('Failed to fetch CSRF token:', error);\n      // Return null if token fetch fails (will retry on next request)\n      return null;\n    } finally {\n      csrfTokenPromise = null;\n    }\n  })();\n  \n  return csrfTokenPromise;\n};\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  // Remove withCredentials to avoid CORS issues - server CORS is configured correctly\n  // withCredentials: true,\n  timeout: 120000, // 120 second timeout (increased for Salesforce API calls, especially KPIs)\n});\n\n// Request interceptor to add auth token and CSRF token\napiClient.interceptors.request.use(\n  async (config) => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    \n    // Add CSRF token for state-changing requests (POST, PUT, DELETE, PATCH)\n    // Skip CSRF for auth endpoints and GET requests\n    if (!config.url?.includes('/auth/') && ['POST', 'PUT', 'DELETE', 'PATCH'].includes(config.method?.toUpperCase())) {\n      try {\n        const csrf = await getCsrfToken();\n        if (csrf) {\n          config.headers['X-CSRF-Token'] = csrf;\n        }\n      } catch (error) {\n        console.warn('Failed to get CSRF token for request:', error);\n      }\n    }\n    \n    // Always log request details in development for debugging\n    if (process.env.NODE_ENV === 'development') {\n      console.log('API Request:', {\n        url: config.url,\n        method: config.method,\n        baseURL: config.baseURL,\n        fullURL: `${config.baseURL}${config.url}`,\n        hasToken: !!token,\n        hasCsrfToken: !!config.headers['X-CSRF-Token'],\n        tokenLength: token ? token.length : 0,\n        headers: {\n          'Content-Type': config.headers['Content-Type'],\n          'Authorization': config.headers.Authorization ? 'Bearer ***' : 'None',\n          'X-CSRF-Token': config.headers['X-CSRF-Token'] ? '***' : 'None',\n          'Origin': window.location.origin\n        },\n        withCredentials: config.withCredentials\n      });\n    } else if (!token) {\n      console.warn('API Request without token:', {\n        url: config.url,\n        method: config.method\n      });\n    }\n    \n    return config;\n  },\n  (error) => {\n    console.error('Request interceptor error:', error);\n    return Promise.reject(error);\n  }\n);\n\n// Use the cached health check function\nconst checkBackendHealth = checkBackendHealthWithCache;\n\n// Export health check function for use in other modules\nexport { checkBackendHealth };\n\n// Response interceptor for error handling\napiClient.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    // Handle 504 Gateway Timeout errors\n    if (error.response?.status === 504 || error.code === 'ECONNREFUSED' || error.code === 'ETIMEDOUT') {\n      const url = error.config?.url || '';\n      console.error('Backend connection error:', {\n        status: error.response?.status,\n        code: error.code,\n        message: error.message,\n        url: url\n      });\n      \n      error.message = 'Backend server is not responding. Please ensure the server is running on port 5000.';\n      error.isBackendDown = true;\n      error.userMessage = 'Unable to connect to server. Please ensure the backend server is running on port 5000.';\n    }\n    \n    // Handle 404 errors - check if backend is ready\n    if (error.response?.status === 404) {\n      const url = error.config?.url || '';\n      const isAuthEndpoint = url.includes('/auth/');\n      \n      // For auth endpoints, check if backend is ready\n      if (isAuthEndpoint) {\n        const isHealthy = await checkBackendHealth();\n        if (!isHealthy) {\n          console.error('Backend is not responding. Please ensure the server is running on port 5000.');\n          error.message = 'Backend server is not responding. Please ensure the server is running on port 5000.';\n          error.isBackendDown = true;\n        } else {\n          console.error('404 on auth endpoint - route may not be registered:', url);\n          error.message = `Route not found: ${url}. Please check that the backend server has restarted and routes are registered.`;\n        }\n      }\n    }\n    \n    // Handle network errors (server not running, CORS blocked, etc.)\n    if (!error.response) {\n      const url = error.config?.url || '';\n      const baseURL = error.config?.baseURL || API_BASE_URL;\n      const fullURL = `${baseURL}${url}`;\n      \n      console.error('Network error - request did not reach server:', {\n        url: url,\n        fullURL: fullURL,\n        baseURL: baseURL,\n        message: error.message,\n        code: error.code,\n        name: error.name\n      });\n      \n      // Check if it's a CORS error\n      if (error.message && (\n        error.message.includes('CORS') || \n        error.message.includes('Network Error') ||\n        error.code === 'ERR_NETWORK' ||\n        error.code === 'ERR_BLOCKED_BY_CLIENT'\n      )) {\n        console.error('CORS or network blocking detected. Check:');\n        console.error('1. Server is running on port 5000');\n        console.error('2. CORS is configured correctly on server');\n        console.error('3. Browser is not blocking the request');\n        console.error('4. Request URL:', fullURL);\n      }\n      \n      const isAuthEndpoint = url.includes('/auth/');\n      \n      // For login/verify endpoints, provide helpful error message\n      if (isAuthEndpoint && (url.includes('/login') || url.includes('/verify'))) {\n        // Don't show error toast for network errors on login - let the component handle it\n        // The error will be caught in the login function and shown there\n      }\n      \n      return Promise.reject(error);\n    }\n    \n    // Handle CSRF token errors - refresh token and retry\n    if (error.response?.status === 403 && error.response?.data?.error?.includes('CSRF')) {\n      // Clear cached CSRF token and retry once\n      csrfToken = null;\n      const originalRequest = error.config;\n      \n      // Only retry if we haven't already retried\n      if (!originalRequest._retry) {\n        originalRequest._retry = true;\n        try {\n          const newCsrfToken = await getCsrfToken();\n          if (newCsrfToken && originalRequest.headers) {\n            originalRequest.headers['X-CSRF-Token'] = newCsrfToken;\n            return apiClient(originalRequest);\n          }\n        } catch (csrfError) {\n          console.error('Failed to refresh CSRF token:', csrfError);\n        }\n      }\n    }\n    \n    if (error.response?.status === 401) {\n      // Check if this is a Salesforce endpoint error (invalid Salesforce credentials)\n      // vs an auth endpoint error (invalid user token)\n      const url = error.config?.url || '';\n      const isSalesforceEndpoint = url.includes('/salesforce/');\n      const isAuthEndpoint = url.includes('/auth/');\n      \n      // Only redirect to login if it's an auth endpoint error (user token invalid)\n      // Salesforce 401 errors should not redirect - they're just invalid Salesforce credentials\n      if (isAuthEndpoint && !isSalesforceEndpoint) {\n        // Token expired or invalid - redirect to login\n        localStorage.removeItem('token');\n        window.location.href = '/login';\n      }\n      // For Salesforce endpoints, just return the error without redirecting\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport default apiClient;\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}