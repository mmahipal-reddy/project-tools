{"ast":null,"code":"import React,{useState}from'react';import{Plus,Package,X}from'lucide-react';import FieldChip from'../FieldChip';import InfoModal from'../../InfoModal';import'../../../../styles/ObjectCard.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ObjectCard=_ref=>{let{objectType,fields,onFieldAdd,onFieldRemove,onFieldReorder,onRemove,showRemove=false}=_ref;const[showInfoModal,setShowInfoModal]=useState(false);const[draggedIndex,setDraggedIndex]=useState(null);const[dragOverIndex,setDragOverIndex]=useState(null);const handleDrop=e=>{e.preventDefault();e.stopPropagation();setDragOverIndex(null);try{const dataStr=e.dataTransfer.getData('application/json');if(!dataStr){return;// No data to process\n}const data=JSON.parse(dataStr);// Handle field reordering\nif(data.type==='field-reorder'&&onFieldReorder){const chipElement=e.target.closest('.field-chip-wrapper');if(chipElement){const dropIndex=parseInt(chipElement.dataset.index);if(!isNaN(dropIndex)&&draggedIndex!==null&&draggedIndex!==dropIndex){onFieldReorder(draggedIndex,dropIndex);}}setDraggedIndex(null);return;}// Handle new field addition\nif(data.type==='field'){const fieldName=typeof data.field==='string'?data.field:data.field.name;// Only accept fields that belong to this object (no relationship prefix)\n// Also check if the source object matches this card's object\nif(!fieldName.includes('.')&&!fieldName.startsWith('SUBQUERY:')){// If sourceObjectType is specified, only accept if it matches this object\nif(data.sourceObjectType&&data.sourceObjectType!==objectType){// Field belongs to a different object, don't add it here\nreturn;}onFieldAdd(data.field);}}}catch(error){console.error('Error handling drop:',error);// Silently fail - don't show browser alert\n}};const handleDragOver=e=>{e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect='move';// Find the index of the field chip being dragged over\nconst chipElement=e.target.closest('.field-chip-wrapper');if(chipElement&&chipElement.dataset.index!==undefined){setDragOverIndex(parseInt(chipElement.dataset.index));}};const handleDragStart=(e,fieldName,index)=>{setDraggedIndex(index);};const handleDragEnd=()=>{setDraggedIndex(null);setDragOverIndex(null);};return/*#__PURE__*/_jsxs(\"div\",{className:\"query-card object-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(Package,{size:18}),/*#__PURE__*/_jsx(\"span\",{children:objectType||'Select Object'})]}),showRemove&&onRemove&&/*#__PURE__*/_jsx(\"button\",{className:\"card-remove-btn\",onClick:onRemove,title:\"Remove object\",children:/*#__PURE__*/_jsx(X,{size:16})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-content\",onDrop:handleDrop,onDragOver:handleDragOver,children:fields.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"card-empty\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Drag fields here or click + Add Field\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"add-field-btn\",onClick:()=>{setShowInfoModal(true);},children:[/*#__PURE__*/_jsx(Plus,{size:14}),\" Add Field\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"card-fields\",onDrop:handleDrop,onDragOver:handleDragOver,onDragLeave:()=>setDragOverIndex(null),children:[fields.map((field,index)=>{const fieldName=typeof field==='string'?field:field.name;const fieldLabel=typeof field==='string'?field:field.label||field.name;return/*#__PURE__*/_jsx(\"div\",{\"data-index\":index,className:\"field-chip-wrapper \".concat(draggedIndex===index?'dragging':'',\" \").concat(dragOverIndex===index?'drag-over':''),children:/*#__PURE__*/_jsx(FieldChip,{label:fieldLabel,name:fieldName,index:index,draggable:true,onRemove:()=>onFieldRemove(fieldName),onDragStart:handleDragStart,onDragEnd:handleDragEnd})},fieldName);}),/*#__PURE__*/_jsxs(\"button\",{className:\"add-field-btn-small\",onClick:()=>{setShowInfoModal(true);},children:[/*#__PURE__*/_jsx(Plus,{size:12}),\" Add Field\"]})]})}),/*#__PURE__*/_jsx(InfoModal,{show:showInfoModal,message:\"Use the left panel to drag fields here, or select fields from the object browser.\",onClose:()=>setShowInfoModal(false),title:\"How to Add Fields\"})]});};export default ObjectCard;","map":{"version":3,"names":["React","useState","Plus","Package","X","FieldChip","InfoModal","jsx","_jsx","jsxs","_jsxs","ObjectCard","_ref","objectType","fields","onFieldAdd","onFieldRemove","onFieldReorder","onRemove","showRemove","showInfoModal","setShowInfoModal","draggedIndex","setDraggedIndex","dragOverIndex","setDragOverIndex","handleDrop","e","preventDefault","stopPropagation","dataStr","dataTransfer","getData","data","JSON","parse","type","chipElement","target","closest","dropIndex","parseInt","dataset","index","isNaN","fieldName","field","name","includes","startsWith","sourceObjectType","error","console","handleDragOver","dropEffect","undefined","handleDragStart","handleDragEnd","className","children","size","onClick","title","onDrop","onDragOver","length","onDragLeave","map","fieldLabel","label","concat","draggable","onDragStart","onDragEnd","show","message","onClose"],"sources":["/Users/mmoola/Cursor/ProjectSetup/client/src/components/AdvancedReportBuilder/QueryCanvas/cards/ObjectCard.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { Plus, Package, X } from 'lucide-react';\nimport FieldChip from '../FieldChip';\nimport InfoModal from '../../InfoModal';\nimport '../../../../styles/ObjectCard.css';\n\nconst ObjectCard = ({ objectType, fields, onFieldAdd, onFieldRemove, onFieldReorder, onRemove, showRemove = false }) => {\n  const [showInfoModal, setShowInfoModal] = useState(false);\n  const [draggedIndex, setDraggedIndex] = useState(null);\n  const [dragOverIndex, setDragOverIndex] = useState(null);\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOverIndex(null);\n    \n    try {\n      const dataStr = e.dataTransfer.getData('application/json');\n      if (!dataStr) {\n        return; // No data to process\n      }\n      \n      const data = JSON.parse(dataStr);\n      \n      // Handle field reordering\n      if (data.type === 'field-reorder' && onFieldReorder) {\n        const chipElement = e.target.closest('.field-chip-wrapper');\n        if (chipElement) {\n          const dropIndex = parseInt(chipElement.dataset.index);\n          if (!isNaN(dropIndex) && draggedIndex !== null && draggedIndex !== dropIndex) {\n            onFieldReorder(draggedIndex, dropIndex);\n          }\n        }\n        setDraggedIndex(null);\n        return;\n      }\n      \n      // Handle new field addition\n      if (data.type === 'field') {\n        const fieldName = typeof data.field === 'string' ? data.field : data.field.name;\n        // Only accept fields that belong to this object (no relationship prefix)\n        // Also check if the source object matches this card's object\n        if (!fieldName.includes('.') && !fieldName.startsWith('SUBQUERY:')) {\n          // If sourceObjectType is specified, only accept if it matches this object\n          if (data.sourceObjectType && data.sourceObjectType !== objectType) {\n            // Field belongs to a different object, don't add it here\n            return;\n          }\n          onFieldAdd(data.field);\n        }\n      }\n    } catch (error) {\n      console.error('Error handling drop:', error);\n      // Silently fail - don't show browser alert\n    }\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    e.dataTransfer.dropEffect = 'move';\n    \n    // Find the index of the field chip being dragged over\n    const chipElement = e.target.closest('.field-chip-wrapper');\n    if (chipElement && chipElement.dataset.index !== undefined) {\n      setDragOverIndex(parseInt(chipElement.dataset.index));\n    }\n  };\n\n  const handleDragStart = (e, fieldName, index) => {\n    setDraggedIndex(index);\n  };\n\n  const handleDragEnd = () => {\n    setDraggedIndex(null);\n    setDragOverIndex(null);\n  };\n\n  return (\n    <div className=\"query-card object-card\">\n      <div className=\"card-header\">\n        <div className=\"card-title\">\n          <Package size={18} />\n          <span>{objectType || 'Select Object'}</span>\n        </div>\n        {showRemove && onRemove && (\n          <button className=\"card-remove-btn\" onClick={onRemove} title=\"Remove object\">\n            <X size={16} />\n          </button>\n        )}\n      </div>\n      \n      <div\n        className=\"card-content\"\n        onDrop={handleDrop}\n        onDragOver={handleDragOver}\n      >\n        {fields.length === 0 ? (\n          <div className=\"card-empty\">\n            <p>Drag fields here or click + Add Field</p>\n            <button\n              className=\"add-field-btn\"\n              onClick={() => {\n                setShowInfoModal(true);\n              }}\n            >\n              <Plus size={14} /> Add Field\n            </button>\n          </div>\n        ) : (\n          <div \n            className=\"card-fields\"\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            onDragLeave={() => setDragOverIndex(null)}\n          >\n            {fields.map((field, index) => {\n              const fieldName = typeof field === 'string' ? field : field.name;\n              const fieldLabel = typeof field === 'string' ? field : (field.label || field.name);\n              return (\n                <div\n                  key={fieldName}\n                  data-index={index}\n                  className={`field-chip-wrapper ${draggedIndex === index ? 'dragging' : ''} ${dragOverIndex === index ? 'drag-over' : ''}`}\n                >\n                  <FieldChip\n                    label={fieldLabel}\n                    name={fieldName}\n                    index={index}\n                    draggable={true}\n                    onRemove={() => onFieldRemove(fieldName)}\n                    onDragStart={handleDragStart}\n                    onDragEnd={handleDragEnd}\n                  />\n                </div>\n              );\n            })}\n            <button\n              className=\"add-field-btn-small\"\n              onClick={() => {\n                setShowInfoModal(true);\n              }}\n            >\n              <Plus size={12} /> Add Field\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Info Modal */}\n      <InfoModal\n        show={showInfoModal}\n        message=\"Use the left panel to drag fields here, or select fields from the object browser.\"\n        onClose={() => setShowInfoModal(false)}\n        title=\"How to Add Fields\"\n      />\n    </div>\n  );\n};\n\nexport default ObjectCard;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}