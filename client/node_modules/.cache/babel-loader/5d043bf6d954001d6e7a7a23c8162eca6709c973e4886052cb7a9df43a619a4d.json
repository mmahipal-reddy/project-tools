{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\nconst reportApiClient = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || '/api',\n  headers: {\n    'Content-Type': 'application/json'\n  },\n  timeout: 120000 // 2 minutes for preview\n});\nreportApiClient.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\nexport const usePreview = () => {\n  _s();\n  const [previewData, setPreviewData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const generatePreview = useCallback(async reportConfig => {\n    // Check if multi-object mode or legacy single-object mode\n    const isMultiObjectMode = reportConfig.objects && reportConfig.objects.length > 0;\n    const hasObjects = isMultiObjectMode || reportConfig.objectType && reportConfig.fields && reportConfig.fields.length > 0;\n    if (!reportConfig || !hasObjects) {\n      setPreviewData(null);\n      return;\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      if (isMultiObjectMode) {\n        // Multi-object mode: send objects array\n        const objects = reportConfig.objects.map(obj => ({\n          objectType: obj.objectType,\n          fields: (obj.fields || []).map(f => typeof f === 'string' ? f : (f === null || f === void 0 ? void 0 : f.name) || f),\n          filters: obj.filters && obj.filters.length > 0 ? {\n            groups: [{\n              id: 'group_1',\n              logic: 'AND',\n              conditions: (obj.filters || []).map(filter => ({\n                field: (filter === null || filter === void 0 ? void 0 : filter.field) || '',\n                operator: (filter === null || filter === void 0 ? void 0 : filter.operator) || 'equals',\n                value: (filter === null || filter === void 0 ? void 0 : filter.value) || ''\n              }))\n            }],\n            groupLogic: 'AND'\n          } : {},\n          relationships: obj.relationships || [],\n          subqueries: obj.subqueries || []\n        }));\n        const response = await reportApiClient.post('/reports/preview-multi', {\n          objects,\n          sortBy: reportConfig.sortBy,\n          sortOrder: reportConfig.sortOrder,\n          groupBy: reportConfig.groupBy,\n          limit: reportConfig.limit || 10000\n        });\n        if (response.data.success) {\n          setPreviewData(response.data.records || []);\n        } else {\n          setError(response.data.error || 'Failed to preview report');\n          toast.error(response.data.error || 'Failed to preview report');\n        }\n      } else {\n        // Legacy single-object mode\n        const fields = (reportConfig.fields || []).map(f => typeof f === 'string' ? f : (f === null || f === void 0 ? void 0 : f.name) || f);\n        const filters = reportConfig.filters && reportConfig.filters.length > 0 ? {\n          groups: [{\n            id: 'group_1',\n            logic: 'AND',\n            conditions: (reportConfig.filters || []).map(filter => ({\n              field: (filter === null || filter === void 0 ? void 0 : filter.field) || '',\n              operator: (filter === null || filter === void 0 ? void 0 : filter.operator) || 'equals',\n              value: (filter === null || filter === void 0 ? void 0 : filter.value) || ''\n            }))\n          }],\n          groupLogic: 'AND'\n        } : {};\n        const response = await reportApiClient.post('/reports/preview', {\n          objectType: reportConfig.objectType,\n          fields,\n          filters,\n          sortBy: reportConfig.sortBy,\n          sortOrder: reportConfig.sortOrder,\n          groupBy: reportConfig.groupBy,\n          limit: reportConfig.limit\n        });\n        if (response.data.success) {\n          setPreviewData(response.data.records || []);\n        } else {\n          setError(response.data.error || 'Failed to preview report');\n          toast.error(response.data.error || 'Failed to preview report');\n        }\n      }\n    } catch (err) {\n      var _err$response, _err$response$data;\n      const errorMessage = ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || err.message || 'Failed to preview report';\n      setError(errorMessage);\n      toast.error(errorMessage);\n      setPreviewData(null);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  return {\n    previewData,\n    loading,\n    error,\n    generatePreview\n  };\n};\n_s(usePreview, \"BAsb8Dswk0wIXzkN/t2NZ+W4ljA=\");","map":{"version":3,"names":["useState","useCallback","axios","toast","reportApiClient","create","baseURL","process","env","REACT_APP_API_URL","headers","timeout","interceptors","request","use","config","token","localStorage","getItem","Authorization","usePreview","_s","previewData","setPreviewData","loading","setLoading","error","setError","generatePreview","reportConfig","isMultiObjectMode","objects","length","hasObjects","objectType","fields","map","obj","f","name","filters","groups","id","logic","conditions","filter","field","operator","value","groupLogic","relationships","subqueries","response","post","sortBy","sortOrder","groupBy","limit","data","success","records","err","_err$response","_err$response$data","errorMessage","message"],"sources":["/Users/mmoola/Cursor/ProjectSetup/client/src/components/AdvancedReportBuilder/hooks/usePreview.js"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\n\nconst reportApiClient = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || '/api',\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  timeout: 120000, // 2 minutes for preview\n});\n\nreportApiClient.interceptors.request.use((config) => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\nexport const usePreview = () => {\n  const [previewData, setPreviewData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const generatePreview = useCallback(async (reportConfig) => {\n    // Check if multi-object mode or legacy single-object mode\n    const isMultiObjectMode = reportConfig.objects && reportConfig.objects.length > 0;\n    const hasObjects = isMultiObjectMode || (reportConfig.objectType && reportConfig.fields && reportConfig.fields.length > 0);\n    \n    if (!reportConfig || !hasObjects) {\n      setPreviewData(null);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      if (isMultiObjectMode) {\n        // Multi-object mode: send objects array\n        const objects = reportConfig.objects.map(obj => ({\n          objectType: obj.objectType,\n          fields: (obj.fields || []).map(f => typeof f === 'string' ? f : (f?.name || f)),\n          filters: (obj.filters && obj.filters.length > 0) ? {\n            groups: [{\n              id: 'group_1',\n              logic: 'AND',\n              conditions: (obj.filters || []).map(filter => ({\n                field: filter?.field || '',\n                operator: filter?.operator || 'equals',\n                value: filter?.value || ''\n              }))\n            }],\n            groupLogic: 'AND'\n          } : {},\n          relationships: obj.relationships || [],\n          subqueries: obj.subqueries || []\n        }));\n\n        const response = await reportApiClient.post('/reports/preview-multi', {\n          objects,\n          sortBy: reportConfig.sortBy,\n          sortOrder: reportConfig.sortOrder,\n          groupBy: reportConfig.groupBy,\n          limit: reportConfig.limit || 10000\n        });\n\n        if (response.data.success) {\n          setPreviewData(response.data.records || []);\n        } else {\n          setError(response.data.error || 'Failed to preview report');\n          toast.error(response.data.error || 'Failed to preview report');\n        }\n      } else {\n        // Legacy single-object mode\n        const fields = (reportConfig.fields || []).map(f => typeof f === 'string' ? f : (f?.name || f));\n\n        const filters = (reportConfig.filters && reportConfig.filters.length > 0) ? {\n          groups: [{\n            id: 'group_1',\n            logic: 'AND',\n            conditions: (reportConfig.filters || []).map(filter => ({\n              field: filter?.field || '',\n              operator: filter?.operator || 'equals',\n              value: filter?.value || ''\n            }))\n          }],\n          groupLogic: 'AND'\n        } : {};\n\n        const response = await reportApiClient.post('/reports/preview', {\n          objectType: reportConfig.objectType,\n          fields,\n          filters,\n          sortBy: reportConfig.sortBy,\n          sortOrder: reportConfig.sortOrder,\n          groupBy: reportConfig.groupBy,\n          limit: reportConfig.limit\n        });\n\n        if (response.data.success) {\n          setPreviewData(response.data.records || []);\n        } else {\n          setError(response.data.error || 'Failed to preview report');\n          toast.error(response.data.error || 'Failed to preview report');\n        }\n      }\n    } catch (err) {\n      const errorMessage = err.response?.data?.error || err.message || 'Failed to preview report';\n      setError(errorMessage);\n      toast.error(errorMessage);\n      setPreviewData(null);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  return {\n    previewData,\n    loading,\n    error,\n    generatePreview\n  };\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}