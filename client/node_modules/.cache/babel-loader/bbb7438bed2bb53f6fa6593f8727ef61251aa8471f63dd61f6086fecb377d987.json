{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef}from'react';import{useAuth}from'../../../context/AuthContext';import Sidebar from'../../../components/Sidebar';import useSidebarWidth from'../../../hooks/useSidebarWidth';import{Menu,LogOut,RefreshCw,Loader,ChevronLeft,ChevronRight}from'lucide-react';import apiClient from'../../../config/api';import toast from'react-hot-toast';import BookmarkButton from'../../../components/BookmarkButton';import DeadlinesPanel from'./components/DeadlinesPanel';import RecordsCount from'./components/RecordsCount';import FieldFilter from'./components/FieldFilter';import PendingHoursCard from'./components/PendingHoursCard';import MetricsRow from'./components/MetricsRow';import PendingUnitsCard from'./components/PendingUnitsCard';import ApprovalsTable from'./components/ApprovalsTable';import ActionButtons from'./components/ActionButtons';import ApprovalModal from'./components/ApprovalModal';import RejectModal from'./components/RejectModal';import EmailModal from'./components/EmailModal';import'./PMApprovals.css';import'../../../styles/Sidebar.css';import'../../../styles/GlobalHeader.css';// Map client-side field names to Salesforce field names for sorting\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const mapSortFieldToSalesforce=clientFieldName=>{const fieldMap={'transactionId':'Transaction_ID__c','contributorName':'Contact__r.Name','email':'Contact__r.Email','projectName':'Contributor_Project__r.Project_Objective__r.Project__r.Name','projectObjectiveName':'Project_Objective__r.Name','accountName':'Contributor_Project__r.Project_Objective__r.Project__r.Account__r.Name','transactionDate':'Transaction_Date__c','variancePercent':'Variance_Percent__c','payrate':'Payrate__c','totalPayment':'Total_Payment__c','status':'Status__c'};return fieldMap[clientFieldName]||clientFieldName;// Return as-is if not in map (might already be Salesforce field name)\n};// Map Salesforce field names back to client-side field names\nconst mapSalesforceToClientField=salesforceFieldName=>{const reverseMap={'Transaction_ID__c':'transactionId','Contact__r.Name':'contributorName','Contact__r.Email':'email','Contributor_Project__r.Project_Objective__r.Project__r.Name':'projectName','Project_Objective__r.Name':'projectObjectiveName','Contributor_Project__r.Project_Objective__r.Project__r.Account__r.Name':'accountName','Transaction_Date__c':'transactionDate','Variance_Percent__c':'variancePercent','Payrate__c':'payrate','Total_Payment__c':'totalPayment','Status__c':'status'};return reverseMap[salesforceFieldName]||salesforceFieldName;// Return as-is if not in map\n};// Client-side sorting function\nconst sortRecords=(records,sortField,sortOrder)=>{if(!sortField||!Array.isArray(records)||records.length===0){return records;}const sorted=[...records].sort((a,b)=>{let aValue=a[sortField];let bValue=b[sortField];// Handle null/undefined values\nif(aValue==null)aValue='';if(bValue==null)bValue='';// Convert to strings for comparison if not already\nconst aStr=String(aValue).trim().toLowerCase();const bStr=String(bValue).trim().toLowerCase();// Try to parse as numbers for numeric fields\nconst numericFields=['variancePercent','payrate','totalPayment','selfReportedHours','selfReportedUnits','systemTrackedHours','systemTrackedUnits'];if(numericFields.includes(sortField)){const aNum=parseFloat(aValue)||0;const bNum=parseFloat(bValue)||0;return sortOrder==='ASC'?aNum-bNum:bNum-aNum;}// Try to parse as dates for date fields\nif(sortField==='transactionDate'){const aDate=aValue?new Date(aValue).getTime():0;const bDate=bValue?new Date(bValue).getTime():0;return sortOrder==='ASC'?aDate-bDate:bDate-aDate;}// String comparison\nif(aStr<bStr)return sortOrder==='ASC'?-1:1;if(aStr>bStr)return sortOrder==='ASC'?1:-1;return 0;});return sorted;};const PMApprovals=()=>{const{user,logout}=useAuth();const[sidebarOpen,setSidebarOpen]=useState(true);const sidebarWidth=useSidebarWidth(sidebarOpen);const[leftPanelCollapsed,setLeftPanelCollapsed]=useState(false);const[loading,setLoading]=useState(true);const[refreshing,setRefreshing]=useState(false);// Data states\nconst[records,setRecords]=useState([]);const[summary,setSummary]=useState(null);const[deadlines,setDeadlines]=useState(null);// Filter states - field-based filtering\nconst[filter,setFilter]=useState({field:'',value:''});const[sortBy,setSortBy]=useState('transactionDate');const[sortOrder,setSortOrder]=useState('DESC');// Table states\nconst[offset,setOffset]=useState(0);const[hasMore,setHasMore]=useState(true);const[loadingMore,setLoadingMore]=useState(false);const[totalRecords,setTotalRecords]=useState(0);const[uniqueRecordsCount,setUniqueRecordsCount]=useState(0);const[duplicatesCount,setDuplicatesCount]=useState(0);const[selectedRows,setSelectedRows]=useState([]);// Modal states\nconst[showApprovalModal,setShowApprovalModal]=useState(false);const[showRejectModal,setShowRejectModal]=useState(false);const[showEmailModal,setShowEmailModal]=useState(false);// Track if warning has been shown to avoid duplicates\nconst warningShownRef=useRef(false);// Track if auto-loading is in progress\nconst autoLoadingRef=useRef(false);// Track current records to avoid stale closures\nconst recordsRef=useRef([]);// Map-based record storage for O(1) lookup and guaranteed uniqueness\nconst recordsMapRef=useRef(new Map());// Track total unique records loaded (for display and comparison)\nconst uniqueRecordsCountRef=useRef(0);// Track total duplicates filtered out across all batches\nconst totalDuplicatesRef=useRef(0);// Track total records received from server (including duplicates)\nconst totalRecordsReceivedRef=useRef(0);const tableContainerRef=useRef(null);// Keep recordsRef and recordsMapRef in sync with records state\nuseEffect(()=>{// Ensure records is always an array\nconst recordsArray=Array.isArray(records)?records:[];recordsRef.current=recordsArray;// Update map whenever records change\nconst newMap=new Map();recordsArray.forEach(record=>{if(record&&record.id){newMap.set(record.id,record);}});recordsMapRef.current=newMap;},[records]);// Fetch deadlines\nconst fetchDeadlines=useCallback(async()=>{try{const response=await apiClient.get('/pm-approvals/deadlines');if(response.data.success){setDeadlines(response.data.deadlines);}}catch(error){console.error('Error fetching deadlines:',error);}},[]);// Fetch filter options\n// No longer need to fetch filter options - values come from table data\n// Fetch summary metrics\nconst fetchSummary=useCallback(async function(){let silent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const params=new URLSearchParams();// For summary, use the filter if available (server-side filters only)\nif(filter&&filter.field&&filter.value&&!['accountName','projectName'].includes(filter.field)){params.append('filterField',filter.field);params.append('filterValue',filter.value);}const response=await apiClient.get(\"/pm-approvals/summary?\".concat(params.toString()));if(response.data.success){setSummary(response.data.data);if(response.data.warning&&!silent&&!warningShownRef.current){warningShownRef.current=true;toast(response.data.warning,{duration:8000,icon:'⚠️',style:{background:'#fffbeb',color:'#92400e',border:'1px solid #fde68a'}});}}}catch(error){console.error('Error fetching summary:',error);if(!silent&&error.code!=='ECONNREFUSED'&&error.code!=='ERR_NETWORK'&&!error.isBackendDown){toast.error('Failed to load summary metrics');}}},[filter]);// Simplified fetch records function - loads 5000 records per batch\nconst fetchRecords=useCallback(async function(){let reset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;let startOffset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let filterOverride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let sortByOverride=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;let sortOrderOverride=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;// Prevent concurrent fetches\nif(autoLoadingRef.current&&!reset){return;}autoLoadingRef.current=true;// Use filterOverride if provided, otherwise use current filter state\nconst activeFilter=filterOverride!==null?filterOverride:filter;// Use sort overrides if provided, otherwise use current sort state\nconst activeSortBy=sortByOverride!==null?sortByOverride:sortBy;const activeSortOrder=sortOrderOverride!==null?sortOrderOverride:sortOrder;if(reset){setLoading(true);setRecords([]);recordsRef.current=[];recordsMapRef.current=new Map();// Reset map\nuniqueRecordsCountRef.current=0;// Reset unique count\ntotalDuplicatesRef.current=0;// Reset duplicates count\ntotalRecordsReceivedRef.current=0;// Reset total received\nsetOffset(0);setTotalRecords(0);setUniqueRecordsCount(0);setDuplicatesCount(0);setHasMore(true);autoLoadingRef.current=false;// Allow reset to proceed\n}else{setLoadingMore(true);}try{const currentOffset=startOffset!==null?startOffset:offset;const params=new URLSearchParams();params.append('offset',currentOffset.toString());params.append('limit','5000');// Request 5,000 records per batch\n// Map client-side field name to Salesforce field name for server query\nconst salesforceSortBy=mapSortFieldToSalesforce(activeSortBy)||'Transaction_Date__c';params.append('sortBy',salesforceSortBy);params.append('sortOrder',activeSortOrder);// Add field-based filter parameters\nif(activeFilter&&activeFilter.field&&activeFilter.value){params.append('filterField',activeFilter.field);params.append('filterValue',activeFilter.value);}const response=await apiClient.get(\"/pm-approvals/list?\".concat(params.toString()));if(response.data.success){// Ensure records is an array\nconst recordsData=response.data.records;const newRecords=Array.isArray(recordsData)?recordsData:[];const total=response.data.total||0;const effectiveOffset=response.data.effectiveOffset!==undefined?response.data.effectiveOffset:currentOffset+newRecords.length;const hasMoreData=response.data.hasMore||false;setTotalRecords(total);// SYSTEMATIC DEDUPLICATION: Use Map-based approach for guaranteed uniqueness\nif(reset){// Reset: Build new map from scratch\nconst recordsMap=new Map();const uniqueRecords=[];let duplicateCount=0;newRecords.forEach(record=>{if(record&&record.id){// Only add if not already in map (guarantees uniqueness)\nif(!recordsMap.has(record.id)){recordsMap.set(record.id,record);uniqueRecords.push(record);}else{duplicateCount++;console.warn(\"Duplicate record detected during reset: \".concat(record.id));}}});recordsMapRef.current=recordsMap;setRecords(uniqueRecords);recordsRef.current=uniqueRecords;uniqueRecordsCountRef.current=uniqueRecords.length;totalRecordsReceivedRef.current=newRecords.length;// Calculate duplicates consistently: total received - unique count\n// This ensures the count is always accurate regardless of batch order\nconst calculatedDuplicates=totalRecordsReceivedRef.current-uniqueRecordsCountRef.current;totalDuplicatesRef.current=calculatedDuplicates;setUniqueRecordsCount(uniqueRecords.length);setDuplicatesCount(calculatedDuplicates);setOffset(uniqueRecords.length);if(newRecords.length!==uniqueRecords.length){console.warn(\"Deduplication: \".concat(newRecords.length,\" records received, \").concat(uniqueRecords.length,\" unique records after deduplication, \").concat(calculatedDuplicates,\" duplicates filtered\"));}// Check if we have more records to load (for reset case)\n// Continue loading as long as server says hasMore=true, regardless of unique count\n// This ensures we process all batches to find all unique records\nconst stillHasMoreReset=hasMoreData&&newRecords.length>0;setHasMore(stillHasMoreReset);// Auto-load next batch if server indicates more records available\n// We continue loading even if all records in this batch were duplicates,\n// because there might be more unique records in subsequent batches\nif(stillHasMoreReset){setTimeout(()=>{fetchRecords(false,effectiveOffset).catch(err=>{console.error('Error auto-loading next batch:',err);setHasMore(false);});},50);// Small delay to keep UI responsive\n}else{setHasMore(false);}}else{// Append: Use functional update with Map-based deduplication\nlet uniqueNewRecordsCount=0;setRecords(prev=>{// Get current map for O(1) lookup\nconst currentMap=recordsMapRef.current;const uniqueNewRecords=[];let duplicateCount=0;newRecords.forEach(record=>{if(record&&record.id){if(!currentMap.has(record.id)){// New record - add to map and list\ncurrentMap.set(record.id,record);uniqueNewRecords.push(record);}else{// Duplicate detected\nduplicateCount++;console.warn(\"Duplicate record detected during append: \".concat(record.id));}}});// Track how many unique records were actually added\nuniqueNewRecordsCount=uniqueNewRecords.length;// Update total duplicates and total received\ntotalDuplicatesRef.current+=duplicateCount;totalRecordsReceivedRef.current+=newRecords.length;if(duplicateCount>0){console.warn(\"Deduplication: \".concat(duplicateCount,\" duplicate(s) filtered out from \").concat(newRecords.length,\" new records\"));}// Build new array from map values to ensure no duplicates\nconst updatedRecords=Array.from(currentMap.values());recordsMapRef.current=currentMap;recordsRef.current=updatedRecords;uniqueRecordsCountRef.current=updatedRecords.length;// Update unique count\n// Calculate duplicates consistently: total received - unique count\n// This ensures the count is always accurate regardless of batch order\nconst calculatedDuplicates=totalRecordsReceivedRef.current-uniqueRecordsCountRef.current;// Update state for display - use calculated duplicates for consistency\nsetUniqueRecordsCount(updatedRecords.length);setDuplicatesCount(calculatedDuplicates);// Also update the ref to keep it in sync\ntotalDuplicatesRef.current=calculatedDuplicates;return updatedRecords;});setOffset(effectiveOffset);// Check if we have more records to load\n// IMPORTANT: Continue loading as long as server says hasMore=true\n// This ensures we process all batches to find all unique records, even if\n// some batches contain only duplicates\n// Only stop if:\n// 1. Server says hasMore=false (no more batches)\n// 2. We received 0 records from API (end of data)\nconst stillHasMore=hasMoreData&&newRecords.length>0;setHasMore(stillHasMore);// Auto-load next batch if server indicates more records available\n// Continue loading even if all records in this batch were duplicates,\n// because there might be more unique records in subsequent batches\nif(stillHasMore){setTimeout(()=>{fetchRecords(false,effectiveOffset).catch(err=>{console.error('Error auto-loading next batch:',err);setHasMore(false);});},50);// Small delay to keep UI responsive\n}else{setHasMore(false);}}if(response.data.warning&&reset&&!warningShownRef.current){warningShownRef.current=true;toast(response.data.warning,{duration:8000,icon:'⚠️',style:{background:'#fffbeb',color:'#92400e',border:'1px solid #fde68a'}});}}else{toast.error(response.data.error||'Failed to fetch approvals');setHasMore(false);}}catch(error){console.error('Error fetching records:',error);if(error.code!=='ECONNREFUSED'&&error.code!=='ERR_NETWORK'&&!error.isBackendDown){toast.error('Failed to fetch approvals');}setHasMore(false);}finally{setLoading(false);setLoadingMore(false);setRefreshing(false);autoLoadingRef.current=false;}},[filter,sortBy,sortOrder,offset]);// Track if initial load has been done\nconst initialLoadDoneRef=useRef(false);// Initial load - only runs once on mount\nuseEffect(()=>{if(!initialLoadDoneRef.current){initialLoadDoneRef.current=true;fetchDeadlines();fetchSummary(true);fetchRecords(true);}},[fetchDeadlines,fetchSummary,fetchRecords]);// Normalize sortBy to always use client-side field names (only if it's a Salesforce field name)\nuseEffect(()=>{const clientSortField=mapSalesforceToClientField(sortBy);// Only update if it's actually a Salesforce field name (mapping changed it)\n// This prevents infinite loops since if it's already a client-side name, clientSortField === sortBy\nif(clientSortField!==sortBy&&sortBy){setSortBy(clientSortField);}},[sortBy]);// Note: Filters and sort changes no longer trigger data reset\n// Data persists during the session and only reloads when refresh button is clicked\nconst handleRefresh=useCallback(e=>{if(e){e.preventDefault();e.stopPropagation();}setRefreshing(true);setOffset(0);setRecords([]);recordsRef.current=[];setHasMore(true);setSelectedRows([]);setTotalRecords(0);warningShownRef.current=false;autoLoadingRef.current=false;fetchRecords(true).finally(()=>{setRefreshing(false);});fetchSummary();},[fetchRecords,fetchSummary]);const handleApplyFilter=useCallback(filterData=>{// Handle new structure from FieldFilter: { filters: [...], sortBy: '', sortOrder: '' }\n// or old structure: { field: '', value: '' }\nlet activeFilter=null;let newSortBy=sortBy;let newSortOrder=sortOrder;let needsRefetch=false;// Check if it's the new structure (from FieldFilter)\nif(filterData.filters!==undefined){// New structure: { filters: [...], sortBy: '', sortOrder: '' }\nconst activeFilters=filterData.filters.filter(f=>f.field&&f.value);if(activeFilters.length>0){// Use the first filter for now (supporting single filter)\nactiveFilter=activeFilters[0];}// Update sort if provided\nif(filterData.sortBy!==undefined){// Map client-side field name to Salesforce field name\nconst clientSortField=filterData.sortBy||'transactionDate';newSortBy=mapSortFieldToSalesforce(clientSortField)||'Transaction_Date__c';needsRefetch=true;}if(filterData.sortOrder!==undefined){newSortOrder=filterData.sortOrder||'DESC';needsRefetch=true;}}else{// Old structure: { field: '', value: '' }\nactiveFilter=filterData;}// Update sort state if changed\nif(newSortBy!==sortBy||newSortOrder!==sortOrder){setSortBy(newSortBy);setSortOrder(newSortOrder);// No need to refetch - sorting is now client-side\n}// ALL filtering is now client-side - just update the filter state\nif(activeFilter){setFilter(activeFilter);setSelectedRows([]);}else if(needsRefetch&&!activeFilter){// Only sort changed, no filter - just update sort state (already done above)\nsetSelectedRows([]);}},[fetchRecords,fetchSummary,sortBy,sortOrder]);const handleClearFilter=useCallback(()=>{// All filtering is client-side - just clear the filter and sort state\nsetFilter({field:'',value:''});setSortBy('transactionDate');setSortOrder('DESC');setSelectedRows([]);// No server refetch needed - filtering and sorting are client-side\n},[]);const handleSort=useCallback((column,order)=>{// Use client-side field name directly for client-side sorting\nconst clientField=column||'transactionDate';const newSortBy=clientField;const newSortOrder=order||'DESC';setSortBy(newSortBy);setSortOrder(newSortOrder);setSelectedRows([]);// No server refetch needed - sorting is now client-side\n},[]);const handleRowSelect=recordId=>{setSelectedRows(prev=>{if(prev.includes(recordId)){return prev.filter(id=>id!==recordId);}else{return[...prev,recordId];}});};const handleApprove=()=>{if(selectedRows.length===0){toast.error('Please select at least one record to approve');return;}setShowApprovalModal(true);};const handleReject=()=>{if(selectedRows.length===0){toast.error('Please select at least one record to reject');return;}setShowRejectModal(true);};const handleSendEmail=()=>{if(selectedRows.length===0){toast.error('Please select at least one record to email');return;}setShowEmailModal(true);};const handleApprovalConfirm=async comment=>{try{const response=await apiClient.post('/pm-approvals/approve',{transactionIds:selectedRows,comment:comment||''});if(response.data.success){toast.success(\"Successfully approved \".concat(response.data.approved,\" record(s)\"));setRecords(prev=>{const filtered=prev.filter(r=>!selectedRows.includes(r.id));// Update map to match filtered records\nconst newMap=new Map();filtered.forEach(record=>{if(record&&record.id){newMap.set(record.id,record);}});recordsMapRef.current=newMap;recordsRef.current=filtered;return filtered;});setSelectedRows([]);setShowApprovalModal(false);fetchSummary();}else{toast.error(response.data.error||'Failed to approve records');}}catch(error){var _error$response,_error$response$data;toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Failed to approve records');}};const handleRejectConfirm=async reason=>{try{const response=await apiClient.post('/pm-approvals/reject',{transactionIds:selectedRows,reason:reason||''});if(response.data.success){toast.success(\"Successfully rejected \".concat(response.data.rejected,\" record(s)\"));setRecords(prev=>{const filtered=prev.filter(r=>!selectedRows.includes(r.id));// Update map to match filtered records\nconst newMap=new Map();filtered.forEach(record=>{if(record&&record.id){newMap.set(record.id,record);}});recordsMapRef.current=newMap;recordsRef.current=filtered;return filtered;});setSelectedRows([]);setShowRejectModal(false);fetchSummary();}else{toast.error(response.data.error||'Failed to reject records');}}catch(error){var _error$response2,_error$response2$data;toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Failed to reject records');}};const handleEmailConfirm=async emailData=>{toast.info('Email functionality coming soon');setShowEmailModal(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-layout\",children:[/*#__PURE__*/_jsx(Sidebar,{isOpen:sidebarOpen,toggleSidebar:()=>setSidebarOpen(!sidebarOpen)}),/*#__PURE__*/_jsx(\"div\",{className:\"pm-approvals-page\",style:{marginLeft:\"\".concat(sidebarWidth,\"px\"),width:\"calc(100% - \".concat(sidebarWidth,\"px)\"),transition:'margin-left 0.2s ease, width 0.2s ease'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"pm-approvals-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pm-approvals-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-left\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"header-menu-toggle\",onClick:()=>setSidebarOpen(!sidebarOpen),\"aria-label\":\"Toggle sidebar\",children:/*#__PURE__*/_jsx(Menu,{size:20})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"PM Approvals for Self Reported Time\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-right\",children:[/*#__PURE__*/_jsx(BookmarkButton,{}),/*#__PURE__*/_jsx(\"button\",{className:\"refresh-btn\",onClick:handleRefresh,disabled:refreshing,title:\"Refresh\",children:/*#__PURE__*/_jsx(RefreshCw,{size:18,className:refreshing?'spinning':''})}),/*#__PURE__*/_jsx(\"div\",{className:\"header-user-profile\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"user-profile\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"user-avatar\",children:((user===null||user===void 0?void 0:user.email)||'U').charAt(0).toUpperCase()}),/*#__PURE__*/_jsx(\"span\",{className:\"user-name\",children:(user===null||user===void 0?void 0:user.email)||'User'}),/*#__PURE__*/_jsx(\"button\",{className:\"logout-btn\",onClick:logout,title:\"Logout\",children:/*#__PURE__*/_jsx(LogOut,{size:18})})]})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pm-approvals-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pm-approvals-sidebar \".concat(leftPanelCollapsed?'collapsed':''),children:[/*#__PURE__*/_jsx(\"button\",{className:\"left-panel-toggle\",onClick:()=>setLeftPanelCollapsed(!leftPanelCollapsed),\"aria-label\":leftPanelCollapsed?'Expand left panel':'Collapse left panel',title:leftPanelCollapsed?'Expand left panel':'Collapse left panel',children:leftPanelCollapsed?/*#__PURE__*/_jsx(ChevronRight,{size:18}):/*#__PURE__*/_jsx(ChevronLeft,{size:18})}),!leftPanelCollapsed&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(DeadlinesPanel,{deadlines:deadlines,loading:!deadlines}),/*#__PURE__*/_jsx(RecordsCount,{count:(()=>{// If client-side filtering is active, show filtered count (works for all fields now)\nif(filter.field&&filter.value){const filteredCount=records.filter(record=>{if(!record)return false;const fieldValue=String(record[filter.field]||'').trim();const filterValue=String(filter.value||'').trim();return fieldValue===filterValue;}).length;return filteredCount;}return uniqueRecordsCount>0?uniqueRecordsCount:records.length;})(),total:uniqueRecordsCount>0?uniqueRecordsCount:records.length,duplicates:duplicatesCount||0,loading:loading,isLoadingMore:loadingMore||hasMore}),/*#__PURE__*/_jsx(FieldFilter,{records:records,onApplyFilter:handleApplyFilter,onClearFilter:handleClearFilter,loading:loading,currentSortBy:sortBy,currentSortOrder:sortOrder,onSortChange:handleSort}),/*#__PURE__*/_jsx(ActionButtons,{onApprove:handleApprove,onReject:handleReject,onSendEmail:handleSendEmail,disabled:loading,selectedCount:selectedRows.length})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pm-approvals-main\",ref:tableContainerRef,children:[/*#__PURE__*/_jsx(\"div\",{className:\"summary-metrics-section\",children:(()=>{// Calculate summary from filtered records if filter is applied\nlet calculatedSummary=null;if(filter.field&&filter.value){const filteredRecords=Array.isArray(records)?records.filter(record=>{if(!record)return false;const fieldValue=String(record[filter.field]||'').trim();const filterValue=String(filter.value||'').trim();return fieldValue===filterValue;}):[];calculatedSummary=filteredRecords.reduce((acc,record)=>{const selfReportedHours=parseFloat(record.selfReportedHours)||0;const systemTrackedHours=parseFloat(record.systemTrackedHours)||0;const selfReportedUnits=parseFloat(record.selfReportedUnits)||0;const totalPayment=parseFloat(record.totalPayment)||0;acc.totalPendingHours+=selfReportedHours;acc.totalHours+=systemTrackedHours;acc.selfReportedTime+=selfReportedHours;acc.systemTracked+=systemTrackedHours;acc.totalPayment+=totalPayment;acc.totalPendingUnits+=selfReportedUnits;return acc;},{totalPendingHours:0,totalHours:0,selfReportedTime:0,systemTracked:0,totalPayment:0,totalPendingUnits:0});}// Use calculated summary if filter is applied, otherwise use server summary\nconst displaySummary=calculatedSummary||summary||{};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PendingHoursCard,{totalPendingHours:displaySummary.totalPendingHours||0,totalHours:displaySummary.totalHours||0}),/*#__PURE__*/_jsx(MetricsRow,{selfReportedTime:displaySummary.selfReportedTime||0,systemTracked:displaySummary.systemTracked||0,payment:displaySummary.totalPayment||0}),/*#__PURE__*/_jsx(PendingUnitsCard,{totalPendingUnits:displaySummary.totalPendingUnits||0})]});})()}),/*#__PURE__*/_jsx(\"div\",{className:\"approvals-table-section\",children:/*#__PURE__*/_jsx(ApprovalsTable,{records:(()=>{// Apply client-side filtering and sorting for all fields\nlet processedRecords=Array.isArray(records)?records:[];// Apply filtering for all fields\nif(filter.field&&filter.value){processedRecords=processedRecords.filter(record=>{if(!record)return false;const fieldValue=String(record[filter.field]||'').trim();const filterValue=String(filter.value||'').trim();return fieldValue===filterValue;});}// Apply client-side sorting\nif(sortBy){// Ensure we use client-side field name for sorting\n// If sortBy is a Salesforce field name, map it to client-side\nconst clientSortField=mapSalesforceToClientField(sortBy);processedRecords=sortRecords(processedRecords,clientSortField,sortOrder);}return processedRecords;})(),loading:loading,onRowClick:record=>{},onSort:handleSort,sortBy:sortBy,sortOrder:sortOrder,selectedRows:selectedRows,onRowSelect:handleRowSelect})})]})]})]})}),showApprovalModal&&/*#__PURE__*/_jsx(ApprovalModal,{selectedCount:selectedRows.length,onConfirm:handleApprovalConfirm,onClose:()=>setShowApprovalModal(false)}),showRejectModal&&/*#__PURE__*/_jsx(RejectModal,{selectedCount:selectedRows.length,onConfirm:handleRejectConfirm,onClose:()=>setShowRejectModal(false)}),showEmailModal&&/*#__PURE__*/_jsx(EmailModal,{selectedCount:selectedRows.length,onConfirm:handleEmailConfirm,onClose:()=>setShowEmailModal(false)})]});};export default PMApprovals;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useAuth","Sidebar","useSidebarWidth","Menu","LogOut","RefreshCw","Loader","ChevronLeft","ChevronRight","apiClient","toast","BookmarkButton","DeadlinesPanel","RecordsCount","FieldFilter","PendingHoursCard","MetricsRow","PendingUnitsCard","ApprovalsTable","ActionButtons","ApprovalModal","RejectModal","EmailModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","mapSortFieldToSalesforce","clientFieldName","fieldMap","mapSalesforceToClientField","salesforceFieldName","reverseMap","sortRecords","records","sortField","sortOrder","Array","isArray","length","sorted","sort","a","b","aValue","bValue","aStr","String","trim","toLowerCase","bStr","numericFields","includes","aNum","parseFloat","bNum","aDate","Date","getTime","bDate","PMApprovals","user","logout","sidebarOpen","setSidebarOpen","sidebarWidth","leftPanelCollapsed","setLeftPanelCollapsed","loading","setLoading","refreshing","setRefreshing","setRecords","summary","setSummary","deadlines","setDeadlines","filter","setFilter","field","value","sortBy","setSortBy","setSortOrder","offset","setOffset","hasMore","setHasMore","loadingMore","setLoadingMore","totalRecords","setTotalRecords","uniqueRecordsCount","setUniqueRecordsCount","duplicatesCount","setDuplicatesCount","selectedRows","setSelectedRows","showApprovalModal","setShowApprovalModal","showRejectModal","setShowRejectModal","showEmailModal","setShowEmailModal","warningShownRef","autoLoadingRef","recordsRef","recordsMapRef","Map","uniqueRecordsCountRef","totalDuplicatesRef","totalRecordsReceivedRef","tableContainerRef","recordsArray","current","newMap","forEach","record","id","set","fetchDeadlines","response","get","data","success","error","console","fetchSummary","silent","arguments","undefined","params","URLSearchParams","append","concat","toString","warning","duration","icon","style","background","color","border","code","isBackendDown","fetchRecords","reset","startOffset","filterOverride","sortByOverride","sortOrderOverride","activeFilter","activeSortBy","activeSortOrder","currentOffset","salesforceSortBy","recordsData","newRecords","total","effectiveOffset","hasMoreData","recordsMap","uniqueRecords","duplicateCount","has","push","warn","calculatedDuplicates","stillHasMoreReset","setTimeout","catch","err","uniqueNewRecordsCount","prev","currentMap","uniqueNewRecords","updatedRecords","from","values","stillHasMore","initialLoadDoneRef","clientSortField","handleRefresh","e","preventDefault","stopPropagation","finally","handleApplyFilter","filterData","newSortBy","newSortOrder","needsRefetch","filters","activeFilters","f","handleClearFilter","handleSort","column","order","clientField","handleRowSelect","recordId","handleApprove","handleReject","handleSendEmail","handleApprovalConfirm","comment","post","transactionIds","approved","filtered","r","_error$response","_error$response$data","handleRejectConfirm","reason","rejected","_error$response2","_error$response2$data","handleEmailConfirm","emailData","info","className","children","isOpen","toggleSidebar","marginLeft","width","transition","onClick","size","disabled","title","email","charAt","toUpperCase","count","filteredCount","fieldValue","filterValue","duplicates","isLoadingMore","onApplyFilter","onClearFilter","currentSortBy","currentSortOrder","onSortChange","onApprove","onReject","onSendEmail","selectedCount","ref","calculatedSummary","filteredRecords","reduce","acc","selfReportedHours","systemTrackedHours","selfReportedUnits","totalPayment","totalPendingHours","totalHours","selfReportedTime","systemTracked","totalPendingUnits","displaySummary","payment","processedRecords","onRowClick","onSort","onRowSelect","onConfirm","onClose"],"sources":["/Users/mmoola/Documents/GitHub/project-tools/client/src/pages/ProjectManagement/PMApprovals/PMApprovals.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useAuth } from '../../../context/AuthContext';\nimport Sidebar from '../../../components/Sidebar';\nimport useSidebarWidth from '../../../hooks/useSidebarWidth';\nimport { Menu, LogOut, RefreshCw, Loader, ChevronLeft, ChevronRight } from 'lucide-react';\nimport apiClient from '../../../config/api';\nimport toast from 'react-hot-toast';\nimport BookmarkButton from '../../../components/BookmarkButton';\nimport DeadlinesPanel from './components/DeadlinesPanel';\nimport RecordsCount from './components/RecordsCount';\nimport FieldFilter from './components/FieldFilter';\nimport PendingHoursCard from './components/PendingHoursCard';\nimport MetricsRow from './components/MetricsRow';\nimport PendingUnitsCard from './components/PendingUnitsCard';\nimport ApprovalsTable from './components/ApprovalsTable';\nimport ActionButtons from './components/ActionButtons';\nimport ApprovalModal from './components/ApprovalModal';\nimport RejectModal from './components/RejectModal';\nimport EmailModal from './components/EmailModal';\nimport './PMApprovals.css';\nimport '../../../styles/Sidebar.css';\nimport '../../../styles/GlobalHeader.css';\n\n// Map client-side field names to Salesforce field names for sorting\nconst mapSortFieldToSalesforce = (clientFieldName) => {\n  const fieldMap = {\n    'transactionId': 'Transaction_ID__c',\n    'contributorName': 'Contact__r.Name',\n    'email': 'Contact__r.Email',\n    'projectName': 'Contributor_Project__r.Project_Objective__r.Project__r.Name',\n    'projectObjectiveName': 'Project_Objective__r.Name',\n    'accountName': 'Contributor_Project__r.Project_Objective__r.Project__r.Account__r.Name',\n    'transactionDate': 'Transaction_Date__c',\n    'variancePercent': 'Variance_Percent__c',\n    'payrate': 'Payrate__c',\n    'totalPayment': 'Total_Payment__c',\n    'status': 'Status__c'\n  };\n  return fieldMap[clientFieldName] || clientFieldName; // Return as-is if not in map (might already be Salesforce field name)\n};\n\n// Map Salesforce field names back to client-side field names\nconst mapSalesforceToClientField = (salesforceFieldName) => {\n  const reverseMap = {\n    'Transaction_ID__c': 'transactionId',\n    'Contact__r.Name': 'contributorName',\n    'Contact__r.Email': 'email',\n    'Contributor_Project__r.Project_Objective__r.Project__r.Name': 'projectName',\n    'Project_Objective__r.Name': 'projectObjectiveName',\n    'Contributor_Project__r.Project_Objective__r.Project__r.Account__r.Name': 'accountName',\n    'Transaction_Date__c': 'transactionDate',\n    'Variance_Percent__c': 'variancePercent',\n    'Payrate__c': 'payrate',\n    'Total_Payment__c': 'totalPayment',\n    'Status__c': 'status'\n  };\n  return reverseMap[salesforceFieldName] || salesforceFieldName; // Return as-is if not in map\n};\n\n// Client-side sorting function\nconst sortRecords = (records, sortField, sortOrder) => {\n  if (!sortField || !Array.isArray(records) || records.length === 0) {\n    return records;\n  }\n\n  const sorted = [...records].sort((a, b) => {\n    let aValue = a[sortField];\n    let bValue = b[sortField];\n\n    // Handle null/undefined values\n    if (aValue == null) aValue = '';\n    if (bValue == null) bValue = '';\n\n    // Convert to strings for comparison if not already\n    const aStr = String(aValue).trim().toLowerCase();\n    const bStr = String(bValue).trim().toLowerCase();\n\n    // Try to parse as numbers for numeric fields\n    const numericFields = ['variancePercent', 'payrate', 'totalPayment', 'selfReportedHours', 'selfReportedUnits', 'systemTrackedHours', 'systemTrackedUnits'];\n    if (numericFields.includes(sortField)) {\n      const aNum = parseFloat(aValue) || 0;\n      const bNum = parseFloat(bValue) || 0;\n      return sortOrder === 'ASC' ? aNum - bNum : bNum - aNum;\n    }\n\n    // Try to parse as dates for date fields\n    if (sortField === 'transactionDate') {\n      const aDate = aValue ? new Date(aValue).getTime() : 0;\n      const bDate = bValue ? new Date(bValue).getTime() : 0;\n      return sortOrder === 'ASC' ? aDate - bDate : bDate - aDate;\n    }\n\n    // String comparison\n    if (aStr < bStr) return sortOrder === 'ASC' ? -1 : 1;\n    if (aStr > bStr) return sortOrder === 'ASC' ? 1 : -1;\n    return 0;\n  });\n\n  return sorted;\n};\n\nconst PMApprovals = () => {\n  const { user, logout } = useAuth();\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const sidebarWidth = useSidebarWidth(sidebarOpen);\n  const [leftPanelCollapsed, setLeftPanelCollapsed] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  \n  // Data states\n  const [records, setRecords] = useState([]);\n  const [summary, setSummary] = useState(null);\n  const [deadlines, setDeadlines] = useState(null);\n  // Filter states - field-based filtering\n  const [filter, setFilter] = useState({ field: '', value: '' });\n  const [sortBy, setSortBy] = useState('transactionDate');\n  const [sortOrder, setSortOrder] = useState('DESC');\n  \n  // Table states\n  const [offset, setOffset] = useState(0);\n  const [hasMore, setHasMore] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [totalRecords, setTotalRecords] = useState(0);\n  const [uniqueRecordsCount, setUniqueRecordsCount] = useState(0);\n  const [duplicatesCount, setDuplicatesCount] = useState(0);\n  const [selectedRows, setSelectedRows] = useState([]);\n  \n  // Modal states\n  const [showApprovalModal, setShowApprovalModal] = useState(false);\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [showEmailModal, setShowEmailModal] = useState(false);\n  \n  // Track if warning has been shown to avoid duplicates\n  const warningShownRef = useRef(false);\n  \n  // Track if auto-loading is in progress\n  const autoLoadingRef = useRef(false);\n  \n  // Track current records to avoid stale closures\n  const recordsRef = useRef([]);\n  \n  // Map-based record storage for O(1) lookup and guaranteed uniqueness\n  const recordsMapRef = useRef(new Map());\n  \n  // Track total unique records loaded (for display and comparison)\n  const uniqueRecordsCountRef = useRef(0);\n  \n  // Track total duplicates filtered out across all batches\n  const totalDuplicatesRef = useRef(0);\n  \n  // Track total records received from server (including duplicates)\n  const totalRecordsReceivedRef = useRef(0);\n  \n  const tableContainerRef = useRef(null);\n  \n  // Keep recordsRef and recordsMapRef in sync with records state\n  useEffect(() => {\n    // Ensure records is always an array\n    const recordsArray = Array.isArray(records) ? records : [];\n    recordsRef.current = recordsArray;\n    // Update map whenever records change\n    const newMap = new Map();\n    recordsArray.forEach(record => {\n      if (record && record.id) {\n        newMap.set(record.id, record);\n      }\n    });\n    recordsMapRef.current = newMap;\n  }, [records]);\n\n  // Fetch deadlines\n  const fetchDeadlines = useCallback(async () => {\n    try {\n      const response = await apiClient.get('/pm-approvals/deadlines');\n      if (response.data.success) {\n        setDeadlines(response.data.deadlines);\n      }\n    } catch (error) {\n      console.error('Error fetching deadlines:', error);\n    }\n  }, []);\n\n  // Fetch filter options\n  // No longer need to fetch filter options - values come from table data\n\n  // Fetch summary metrics\n  const fetchSummary = useCallback(async (silent = false) => {\n    try {\n      const params = new URLSearchParams();\n      // For summary, use the filter if available (server-side filters only)\n      if (filter && filter.field && filter.value && !['accountName', 'projectName'].includes(filter.field)) {\n        params.append('filterField', filter.field);\n        params.append('filterValue', filter.value);\n      }\n      \n      const response = await apiClient.get(`/pm-approvals/summary?${params.toString()}`);\n      if (response.data.success) {\n        setSummary(response.data.data);\n        \n        if (response.data.warning && !silent && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error fetching summary:', error);\n      if (!silent && error.code !== 'ECONNREFUSED' && error.code !== 'ERR_NETWORK' && !error.isBackendDown) {\n        toast.error('Failed to load summary metrics');\n      }\n    }\n  }, [filter]);\n\n  // Simplified fetch records function - loads 5000 records per batch\n  const fetchRecords = useCallback(async (reset = false, startOffset = null, filterOverride = null, sortByOverride = null, sortOrderOverride = null) => {\n    // Prevent concurrent fetches\n    if (autoLoadingRef.current && !reset) {\n      return;\n    }\n    \n    autoLoadingRef.current = true;\n    \n    // Use filterOverride if provided, otherwise use current filter state\n    const activeFilter = filterOverride !== null ? filterOverride : filter;\n    // Use sort overrides if provided, otherwise use current sort state\n    const activeSortBy = sortByOverride !== null ? sortByOverride : sortBy;\n    const activeSortOrder = sortOrderOverride !== null ? sortOrderOverride : sortOrder;\n    \n    if (reset) {\n      setLoading(true);\n      setRecords([]);\n      recordsRef.current = [];\n      recordsMapRef.current = new Map(); // Reset map\n      uniqueRecordsCountRef.current = 0; // Reset unique count\n      totalDuplicatesRef.current = 0; // Reset duplicates count\n      totalRecordsReceivedRef.current = 0; // Reset total received\n      setOffset(0);\n      setTotalRecords(0);\n      setUniqueRecordsCount(0);\n      setDuplicatesCount(0);\n      setHasMore(true);\n      autoLoadingRef.current = false; // Allow reset to proceed\n    } else {\n      setLoadingMore(true);\n    }\n\n    try {\n      const currentOffset = startOffset !== null ? startOffset : offset;\n      const params = new URLSearchParams();\n      params.append('offset', currentOffset.toString());\n      params.append('limit', '5000'); // Request 5,000 records per batch\n      // Map client-side field name to Salesforce field name for server query\n      const salesforceSortBy = mapSortFieldToSalesforce(activeSortBy) || 'Transaction_Date__c';\n      params.append('sortBy', salesforceSortBy);\n      params.append('sortOrder', activeSortOrder);\n      \n      // Add field-based filter parameters\n      if (activeFilter && activeFilter.field && activeFilter.value) {\n        params.append('filterField', activeFilter.field);\n        params.append('filterValue', activeFilter.value);\n      }\n      \n      \n      const response = await apiClient.get(`/pm-approvals/list?${params.toString()}`);\n      \n      if (response.data.success) {\n        // Ensure records is an array\n        const recordsData = response.data.records;\n        const newRecords = Array.isArray(recordsData) ? recordsData : [];\n        const total = response.data.total || 0;\n        const effectiveOffset = response.data.effectiveOffset !== undefined \n          ? response.data.effectiveOffset \n          : (currentOffset + newRecords.length);\n        const hasMoreData = response.data.hasMore || false;\n        \n        setTotalRecords(total);\n        \n        // SYSTEMATIC DEDUPLICATION: Use Map-based approach for guaranteed uniqueness\n        if (reset) {\n          // Reset: Build new map from scratch\n          const recordsMap = new Map();\n          const uniqueRecords = [];\n          let duplicateCount = 0;\n          \n          newRecords.forEach(record => {\n            if (record && record.id) {\n              // Only add if not already in map (guarantees uniqueness)\n              if (!recordsMap.has(record.id)) {\n                recordsMap.set(record.id, record);\n                uniqueRecords.push(record);\n              } else {\n                duplicateCount++;\n                console.warn(`Duplicate record detected during reset: ${record.id}`);\n              }\n            }\n          });\n          \n          recordsMapRef.current = recordsMap;\n          setRecords(uniqueRecords);\n          recordsRef.current = uniqueRecords;\n          uniqueRecordsCountRef.current = uniqueRecords.length;\n          totalRecordsReceivedRef.current = newRecords.length;\n          \n          // Calculate duplicates consistently: total received - unique count\n          // This ensures the count is always accurate regardless of batch order\n          const calculatedDuplicates = totalRecordsReceivedRef.current - uniqueRecordsCountRef.current;\n          totalDuplicatesRef.current = calculatedDuplicates;\n          \n          setUniqueRecordsCount(uniqueRecords.length);\n          setDuplicatesCount(calculatedDuplicates);\n          setOffset(uniqueRecords.length);\n          \n          if (newRecords.length !== uniqueRecords.length) {\n            console.warn(`Deduplication: ${newRecords.length} records received, ${uniqueRecords.length} unique records after deduplication, ${calculatedDuplicates} duplicates filtered`);\n          }\n          \n          // Check if we have more records to load (for reset case)\n          // Continue loading as long as server says hasMore=true, regardless of unique count\n          // This ensures we process all batches to find all unique records\n          const stillHasMoreReset = hasMoreData && (newRecords.length > 0);\n          setHasMore(stillHasMoreReset);\n          \n          // Auto-load next batch if server indicates more records available\n          // We continue loading even if all records in this batch were duplicates,\n          // because there might be more unique records in subsequent batches\n          if (stillHasMoreReset) {\n            setTimeout(() => {\n              fetchRecords(false, effectiveOffset).catch((err) => {\n                console.error('Error auto-loading next batch:', err);\n                setHasMore(false);\n              });\n            }, 50); // Small delay to keep UI responsive\n          } else {\n            setHasMore(false);\n          }\n        } else {\n          // Append: Use functional update with Map-based deduplication\n          let uniqueNewRecordsCount = 0;\n          setRecords(prev => {\n            // Get current map for O(1) lookup\n            const currentMap = recordsMapRef.current;\n            const uniqueNewRecords = [];\n            let duplicateCount = 0;\n            \n            newRecords.forEach(record => {\n              if (record && record.id) {\n                if (!currentMap.has(record.id)) {\n                  // New record - add to map and list\n                  currentMap.set(record.id, record);\n                  uniqueNewRecords.push(record);\n                } else {\n                  // Duplicate detected\n                  duplicateCount++;\n                  console.warn(`Duplicate record detected during append: ${record.id}`);\n                }\n              }\n            });\n            \n            // Track how many unique records were actually added\n            uniqueNewRecordsCount = uniqueNewRecords.length;\n            \n            // Update total duplicates and total received\n            totalDuplicatesRef.current += duplicateCount;\n            totalRecordsReceivedRef.current += newRecords.length;\n            \n            if (duplicateCount > 0) {\n              console.warn(`Deduplication: ${duplicateCount} duplicate(s) filtered out from ${newRecords.length} new records`);\n            }\n            \n            // Build new array from map values to ensure no duplicates\n            const updatedRecords = Array.from(currentMap.values());\n            recordsMapRef.current = currentMap;\n            recordsRef.current = updatedRecords;\n            uniqueRecordsCountRef.current = updatedRecords.length; // Update unique count\n            \n            // Calculate duplicates consistently: total received - unique count\n            // This ensures the count is always accurate regardless of batch order\n            const calculatedDuplicates = totalRecordsReceivedRef.current - uniqueRecordsCountRef.current;\n            \n            // Update state for display - use calculated duplicates for consistency\n            setUniqueRecordsCount(updatedRecords.length);\n            setDuplicatesCount(calculatedDuplicates);\n            \n            // Also update the ref to keep it in sync\n            totalDuplicatesRef.current = calculatedDuplicates;\n            \n            return updatedRecords;\n          });\n          setOffset(effectiveOffset);\n          \n          // Check if we have more records to load\n          // IMPORTANT: Continue loading as long as server says hasMore=true\n          // This ensures we process all batches to find all unique records, even if\n          // some batches contain only duplicates\n          // Only stop if:\n          // 1. Server says hasMore=false (no more batches)\n          // 2. We received 0 records from API (end of data)\n          const stillHasMore = hasMoreData && (newRecords.length > 0);\n          setHasMore(stillHasMore);\n          \n          // Auto-load next batch if server indicates more records available\n          // Continue loading even if all records in this batch were duplicates,\n          // because there might be more unique records in subsequent batches\n          if (stillHasMore) {\n            setTimeout(() => {\n              fetchRecords(false, effectiveOffset).catch((err) => {\n                console.error('Error auto-loading next batch:', err);\n                setHasMore(false);\n              });\n            }, 50); // Small delay to keep UI responsive\n          } else {\n            setHasMore(false);\n          }\n        }\n        \n        if (response.data.warning && reset && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      } else {\n        toast.error(response.data.error || 'Failed to fetch approvals');\n        setHasMore(false);\n      }\n    } catch (error) {\n      console.error('Error fetching records:', error);\n      if (error.code !== 'ECONNREFUSED' && error.code !== 'ERR_NETWORK' && !error.isBackendDown) {\n        toast.error('Failed to fetch approvals');\n      }\n      setHasMore(false);\n    } finally {\n      setLoading(false);\n      setLoadingMore(false);\n      setRefreshing(false);\n      autoLoadingRef.current = false;\n    }\n  }, [filter, sortBy, sortOrder, offset]);\n\n  // Track if initial load has been done\n  const initialLoadDoneRef = useRef(false);\n  \n  // Initial load - only runs once on mount\n  useEffect(() => {\n    if (!initialLoadDoneRef.current) {\n      initialLoadDoneRef.current = true;\n      fetchDeadlines();\n      fetchSummary(true);\n      fetchRecords(true);\n    }\n  }, [fetchDeadlines, fetchSummary, fetchRecords]);\n\n  // Normalize sortBy to always use client-side field names (only if it's a Salesforce field name)\n  useEffect(() => {\n    const clientSortField = mapSalesforceToClientField(sortBy);\n    // Only update if it's actually a Salesforce field name (mapping changed it)\n    // This prevents infinite loops since if it's already a client-side name, clientSortField === sortBy\n    if (clientSortField !== sortBy && sortBy) {\n      setSortBy(clientSortField);\n    }\n  }, [sortBy]);\n\n  // Note: Filters and sort changes no longer trigger data reset\n  // Data persists during the session and only reloads when refresh button is clicked\n\n  const handleRefresh = useCallback((e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setRefreshing(true);\n    setOffset(0);\n    setRecords([]);\n    recordsRef.current = [];\n    setHasMore(true);\n    setSelectedRows([]);\n    setTotalRecords(0);\n    warningShownRef.current = false;\n    autoLoadingRef.current = false;\n    fetchRecords(true).finally(() => {\n      setRefreshing(false);\n    });\n    fetchSummary();\n  }, [fetchRecords, fetchSummary]);\n\n\n  const handleApplyFilter = useCallback((filterData) => {\n    // Handle new structure from FieldFilter: { filters: [...], sortBy: '', sortOrder: '' }\n    // or old structure: { field: '', value: '' }\n    let activeFilter = null;\n    let newSortBy = sortBy;\n    let newSortOrder = sortOrder;\n    let needsRefetch = false;\n\n    // Check if it's the new structure (from FieldFilter)\n    if (filterData.filters !== undefined) {\n      // New structure: { filters: [...], sortBy: '', sortOrder: '' }\n      const activeFilters = filterData.filters.filter(f => f.field && f.value);\n      if (activeFilters.length > 0) {\n        // Use the first filter for now (supporting single filter)\n        activeFilter = activeFilters[0];\n      }\n      \n      // Update sort if provided\n      if (filterData.sortBy !== undefined) {\n        // Map client-side field name to Salesforce field name\n        const clientSortField = filterData.sortBy || 'transactionDate';\n        newSortBy = mapSortFieldToSalesforce(clientSortField) || 'Transaction_Date__c';\n        needsRefetch = true;\n      }\n      if (filterData.sortOrder !== undefined) {\n        newSortOrder = filterData.sortOrder || 'DESC';\n        needsRefetch = true;\n      }\n    } else {\n      // Old structure: { field: '', value: '' }\n      activeFilter = filterData;\n    }\n\n    // Update sort state if changed\n    if (newSortBy !== sortBy || newSortOrder !== sortOrder) {\n      setSortBy(newSortBy);\n      setSortOrder(newSortOrder);\n      // No need to refetch - sorting is now client-side\n    }\n\n    // ALL filtering is now client-side - just update the filter state\n    if (activeFilter) {\n      setFilter(activeFilter);\n      setSelectedRows([]);\n    } else if (needsRefetch && !activeFilter) {\n      // Only sort changed, no filter - just update sort state (already done above)\n      setSelectedRows([]);\n    }\n  }, [fetchRecords, fetchSummary, sortBy, sortOrder]);\n\n  const handleClearFilter = useCallback(() => {\n    // All filtering is client-side - just clear the filter and sort state\n    setFilter({ field: '', value: '' });\n    setSortBy('transactionDate');\n    setSortOrder('DESC');\n    setSelectedRows([]);\n    // No server refetch needed - filtering and sorting are client-side\n  }, []);\n\n  const handleSort = useCallback((column, order) => {\n    // Use client-side field name directly for client-side sorting\n    const clientField = column || 'transactionDate';\n    const newSortBy = clientField;\n    const newSortOrder = order || 'DESC';\n    \n    setSortBy(newSortBy);\n    setSortOrder(newSortOrder);\n    setSelectedRows([]);\n    // No server refetch needed - sorting is now client-side\n  }, []);\n\n  const handleRowSelect = (recordId) => {\n    setSelectedRows(prev => {\n      if (prev.includes(recordId)) {\n        return prev.filter(id => id !== recordId);\n      } else {\n        return [...prev, recordId];\n      }\n    });\n  };\n\n  const handleApprove = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to approve');\n      return;\n    }\n    setShowApprovalModal(true);\n  };\n\n  const handleReject = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to reject');\n      return;\n    }\n    setShowRejectModal(true);\n  };\n\n  const handleSendEmail = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to email');\n      return;\n    }\n    setShowEmailModal(true);\n  };\n\n  const handleApprovalConfirm = async (comment) => {\n    try {\n      const response = await apiClient.post('/pm-approvals/approve', {\n        transactionIds: selectedRows,\n        comment: comment || ''\n      });\n      \n      if (response.data.success) {\n        toast.success(`Successfully approved ${response.data.approved} record(s)`);\n        setRecords(prev => {\n          const filtered = prev.filter(r => !selectedRows.includes(r.id));\n          // Update map to match filtered records\n          const newMap = new Map();\n          filtered.forEach(record => {\n            if (record && record.id) {\n              newMap.set(record.id, record);\n            }\n          });\n          recordsMapRef.current = newMap;\n          recordsRef.current = filtered;\n          return filtered;\n        });\n        setSelectedRows([]);\n        setShowApprovalModal(false);\n        fetchSummary();\n      } else {\n        toast.error(response.data.error || 'Failed to approve records');\n      }\n    } catch (error) {\n      toast.error(error.response?.data?.error || 'Failed to approve records');\n    }\n  };\n\n  const handleRejectConfirm = async (reason) => {\n    try {\n      const response = await apiClient.post('/pm-approvals/reject', {\n        transactionIds: selectedRows,\n        reason: reason || ''\n      });\n      \n      if (response.data.success) {\n        toast.success(`Successfully rejected ${response.data.rejected} record(s)`);\n        setRecords(prev => {\n          const filtered = prev.filter(r => !selectedRows.includes(r.id));\n          // Update map to match filtered records\n          const newMap = new Map();\n          filtered.forEach(record => {\n            if (record && record.id) {\n              newMap.set(record.id, record);\n            }\n          });\n          recordsMapRef.current = newMap;\n          recordsRef.current = filtered;\n          return filtered;\n        });\n        setSelectedRows([]);\n        setShowRejectModal(false);\n        fetchSummary();\n      } else {\n        toast.error(response.data.error || 'Failed to reject records');\n      }\n    } catch (error) {\n      toast.error(error.response?.data?.error || 'Failed to reject records');\n    }\n  };\n\n  const handleEmailConfirm = async (emailData) => {\n    toast.info('Email functionality coming soon');\n    setShowEmailModal(false);\n  };\n\n  return (\n    <div className=\"dashboard-layout\">\n      <Sidebar isOpen={sidebarOpen} toggleSidebar={() => setSidebarOpen(!sidebarOpen)} />\n      \n      <div \n        className=\"pm-approvals-page\" \n        style={{ \n          marginLeft: `${sidebarWidth}px`, \n          width: `calc(100% - ${sidebarWidth}px)`,\n          transition: 'margin-left 0.2s ease, width 0.2s ease'\n        }}\n      >\n        <div className=\"pm-approvals-container\">\n          {/* Header */}\n          <div className=\"pm-approvals-header\">\n            <div className=\"header-content\">\n              <div className=\"header-left\">\n                <button \n                  className=\"header-menu-toggle\"\n                  onClick={() => setSidebarOpen(!sidebarOpen)}\n                  aria-label=\"Toggle sidebar\"\n                >\n                  <Menu size={20} />\n                </button>\n                <div>\n                  <h1 className=\"page-title\">PM Approvals for Self Reported Time</h1>\n                </div>\n              </div>\n              <div className=\"header-right\">\n                <BookmarkButton />\n                <button\n                  className=\"refresh-btn\"\n                  onClick={handleRefresh}\n                  disabled={refreshing}\n                  title=\"Refresh\"\n                >\n                  <RefreshCw size={18} className={refreshing ? 'spinning' : ''} />\n                </button>\n                <div className=\"header-user-profile\">\n                  <div className=\"user-profile\">\n                    <div className=\"user-avatar\">\n                      {(user?.email || 'U').charAt(0).toUpperCase()}\n                    </div>\n                    <span className=\"user-name\">{user?.email || 'User'}</span>\n                    <button className=\"logout-btn\" onClick={logout} title=\"Logout\">\n                      <LogOut size={18} />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Main Content */}\n          <div className=\"pm-approvals-content\">\n            {/* Left Sidebar */}\n            <div className={`pm-approvals-sidebar ${leftPanelCollapsed ? 'collapsed' : ''}`}>\n              <button\n                className=\"left-panel-toggle\"\n                onClick={() => setLeftPanelCollapsed(!leftPanelCollapsed)}\n                aria-label={leftPanelCollapsed ? 'Expand left panel' : 'Collapse left panel'}\n                title={leftPanelCollapsed ? 'Expand left panel' : 'Collapse left panel'}\n              >\n                {leftPanelCollapsed ? <ChevronRight size={18} /> : <ChevronLeft size={18} />}\n              </button>\n              {!leftPanelCollapsed && (\n                <>\n                  <DeadlinesPanel deadlines={deadlines} loading={!deadlines} />\n                  <RecordsCount \n                count={(() => {\n                  // If client-side filtering is active, show filtered count (works for all fields now)\n                  if (filter.field && filter.value) {\n                    const filteredCount = records.filter(record => {\n                      if (!record) return false;\n                      const fieldValue = String(record[filter.field] || '').trim();\n                      const filterValue = String(filter.value || '').trim();\n                      return fieldValue === filterValue;\n                    }).length;\n                    return filteredCount;\n                  }\n                  return uniqueRecordsCount > 0 ? uniqueRecordsCount : records.length;\n                })()}\n                total={uniqueRecordsCount > 0 ? uniqueRecordsCount : records.length}\n                duplicates={duplicatesCount || 0}\n                loading={loading} \n                isLoadingMore={loadingMore || hasMore}\n              />\n              <FieldFilter\n                records={records}\n                onApplyFilter={handleApplyFilter}\n                onClearFilter={handleClearFilter}\n                loading={loading}\n                currentSortBy={sortBy}\n                currentSortOrder={sortOrder}\n                onSortChange={handleSort}\n              />\n                  <ActionButtons\n                    onApprove={handleApprove}\n                    onReject={handleReject}\n                    onSendEmail={handleSendEmail}\n                    disabled={loading}\n                    selectedCount={selectedRows.length}\n                  />\n                </>\n              )}\n            </div>\n\n            {/* Main Content Area */}\n            <div className=\"pm-approvals-main\" ref={tableContainerRef}>\n              {/* Summary Metrics */}\n              <div className=\"summary-metrics-section\">\n                {(() => {\n                  // Calculate summary from filtered records if filter is applied\n                  let calculatedSummary = null;\n                  if (filter.field && filter.value) {\n                    const filteredRecords = Array.isArray(records) ? records.filter(record => {\n                      if (!record) return false;\n                      const fieldValue = String(record[filter.field] || '').trim();\n                      const filterValue = String(filter.value || '').trim();\n                      return fieldValue === filterValue;\n                    }) : [];\n                    \n                    calculatedSummary = filteredRecords.reduce((acc, record) => {\n                      const selfReportedHours = parseFloat(record.selfReportedHours) || 0;\n                      const systemTrackedHours = parseFloat(record.systemTrackedHours) || 0;\n                      const selfReportedUnits = parseFloat(record.selfReportedUnits) || 0;\n                      const totalPayment = parseFloat(record.totalPayment) || 0;\n                      \n                      acc.totalPendingHours += selfReportedHours;\n                      acc.totalHours += systemTrackedHours;\n                      acc.selfReportedTime += selfReportedHours;\n                      acc.systemTracked += systemTrackedHours;\n                      acc.totalPayment += totalPayment;\n                      acc.totalPendingUnits += selfReportedUnits;\n                      \n                      return acc;\n                    }, {\n                      totalPendingHours: 0,\n                      totalHours: 0,\n                      selfReportedTime: 0,\n                      systemTracked: 0,\n                      totalPayment: 0,\n                      totalPendingUnits: 0\n                    });\n                  }\n                  \n                  // Use calculated summary if filter is applied, otherwise use server summary\n                  const displaySummary = calculatedSummary || summary || {};\n                  \n                  return (\n                    <>\n                      <PendingHoursCard\n                        totalPendingHours={displaySummary.totalPendingHours || 0}\n                        totalHours={displaySummary.totalHours || 0}\n                      />\n                      <MetricsRow\n                        selfReportedTime={displaySummary.selfReportedTime || 0}\n                        systemTracked={displaySummary.systemTracked || 0}\n                        payment={displaySummary.totalPayment || 0}\n                      />\n                      <PendingUnitsCard\n                        totalPendingUnits={displaySummary.totalPendingUnits || 0}\n                      />\n                    </>\n                  );\n                })()}\n              </div>\n\n              {/* Table */}\n              <div className=\"approvals-table-section\">\n                <ApprovalsTable\n                  records={(() => {\n                    // Apply client-side filtering and sorting for all fields\n                    let processedRecords = Array.isArray(records) ? records : [];\n                    \n                    // Apply filtering for all fields\n                    if (filter.field && filter.value) {\n                      processedRecords = processedRecords.filter(record => {\n                        if (!record) return false;\n                        const fieldValue = String(record[filter.field] || '').trim();\n                        const filterValue = String(filter.value || '').trim();\n                        return fieldValue === filterValue;\n                      });\n                    }\n                    \n                    // Apply client-side sorting\n                    if (sortBy) {\n                      // Ensure we use client-side field name for sorting\n                      // If sortBy is a Salesforce field name, map it to client-side\n                      const clientSortField = mapSalesforceToClientField(sortBy);\n                      processedRecords = sortRecords(processedRecords, clientSortField, sortOrder);\n                    }\n                    \n                    return processedRecords;\n                  })()}\n                  loading={loading}\n                  onRowClick={(record) => {}}\n                  onSort={handleSort}\n                  sortBy={sortBy}\n                  sortOrder={sortOrder}\n                  selectedRows={selectedRows}\n                  onRowSelect={handleRowSelect}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Modals */}\n      {showApprovalModal && (\n        <ApprovalModal\n          selectedCount={selectedRows.length}\n          onConfirm={handleApprovalConfirm}\n          onClose={() => setShowApprovalModal(false)}\n        />\n      )}\n      {showRejectModal && (\n        <RejectModal\n          selectedCount={selectedRows.length}\n          onConfirm={handleRejectConfirm}\n          onClose={() => setShowRejectModal(false)}\n        />\n      )}\n      {showEmailModal && (\n        <EmailModal\n          selectedCount={selectedRows.length}\n          onConfirm={handleEmailConfirm}\n          onClose={() => setShowEmailModal(false)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default PMApprovals;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}