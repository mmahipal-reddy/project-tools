{"ast":null,"code":"import{useState,useCallback}from'react';import apiClient from'../../../config/api';import axios from'axios';import toast from'react-hot-toast';const reportApiClient=axios.create({baseURL:process.env.REACT_APP_API_URL||'/api',headers:{'Content-Type':'application/json'},timeout:120000// 2 minutes for preview\n});reportApiClient.interceptors.request.use(config=>{const token=localStorage.getItem('token');if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;});export const usePreview=()=>{const[previewData,setPreviewData]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const generatePreview=useCallback(async reportConfig=>{if(!reportConfig.objectType||reportConfig.fields.length===0){setPreviewData(null);return;}setLoading(true);setError(null);try{// Build fields array from config\nconst fields=[...reportConfig.fields.map(f=>typeof f==='string'?f:f.name),...(reportConfig.relationships||[]).flatMap(rel=>(rel.fields||[]).map(field=>\"\".concat(rel.relationshipName,\".\").concat(field))),...(reportConfig.subqueries||[]).flatMap(sub=>(sub.fields||[]).map(field=>\"SUBQUERY:\".concat(sub.relationshipName,\".\").concat(field)))];// Build filters structure\nconst filters=reportConfig.filters.length>0?{groups:[{id:'group_1',logic:'AND',conditions:reportConfig.filters.map(filter=>({field:filter.field,operator:filter.operator,value:filter.value}))}],groupLogic:'AND'}:{};const response=await reportApiClient.post('/reports/preview',{objectType:reportConfig.objectType,fields,filters,sortBy:reportConfig.sortBy,sortOrder:reportConfig.sortOrder,groupBy:reportConfig.groupBy,limit:reportConfig.limit});if(response.data.success){setPreviewData(response.data.records||[]);}else{setError(response.data.error||'Failed to preview report');toast.error(response.data.error||'Failed to preview report');}}catch(err){var _err$response,_err$response$data;const errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||err.message||'Failed to preview report';setError(errorMessage);toast.error(errorMessage);setPreviewData(null);}finally{setLoading(false);}},[]);return{previewData,loading,error,generatePreview};};","map":{"version":3,"names":["useState","useCallback","apiClient","axios","toast","reportApiClient","create","baseURL","process","env","REACT_APP_API_URL","headers","timeout","interceptors","request","use","config","token","localStorage","getItem","Authorization","concat","usePreview","previewData","setPreviewData","loading","setLoading","error","setError","generatePreview","reportConfig","objectType","fields","length","map","f","name","relationships","flatMap","rel","field","relationshipName","subqueries","sub","filters","groups","id","logic","conditions","filter","operator","value","groupLogic","response","post","sortBy","sortOrder","groupBy","limit","data","success","records","err","_err$response","_err$response$data","errorMessage","message"],"sources":["/Users/mmoola/Cursor/ProjectSetup/client/src/components/AdvancedReportBuilder/hooks/usePreview.js"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport apiClient from '../../../config/api';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\n\nconst reportApiClient = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || '/api',\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  timeout: 120000, // 2 minutes for preview\n});\n\nreportApiClient.interceptors.request.use((config) => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\nexport const usePreview = () => {\n  const [previewData, setPreviewData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const generatePreview = useCallback(async (reportConfig) => {\n    if (!reportConfig.objectType || reportConfig.fields.length === 0) {\n      setPreviewData(null);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Build fields array from config\n      const fields = [\n        ...reportConfig.fields.map(f => typeof f === 'string' ? f : f.name),\n        ...(reportConfig.relationships || []).flatMap(rel => \n          (rel.fields || []).map(field => `${rel.relationshipName}.${field}`)\n        ),\n        ...(reportConfig.subqueries || []).flatMap(sub => \n          (sub.fields || []).map(field => `SUBQUERY:${sub.relationshipName}.${field}`)\n        )\n      ];\n\n      // Build filters structure\n      const filters = reportConfig.filters.length > 0 ? {\n        groups: [{\n          id: 'group_1',\n          logic: 'AND',\n          conditions: reportConfig.filters.map(filter => ({\n            field: filter.field,\n            operator: filter.operator,\n            value: filter.value\n          }))\n        }],\n        groupLogic: 'AND'\n      } : {};\n\n      const response = await reportApiClient.post('/reports/preview', {\n        objectType: reportConfig.objectType,\n        fields,\n        filters,\n        sortBy: reportConfig.sortBy,\n        sortOrder: reportConfig.sortOrder,\n        groupBy: reportConfig.groupBy,\n        limit: reportConfig.limit\n      });\n\n      if (response.data.success) {\n        setPreviewData(response.data.records || []);\n      } else {\n        setError(response.data.error || 'Failed to preview report');\n        toast.error(response.data.error || 'Failed to preview report');\n      }\n    } catch (err) {\n      const errorMessage = err.response?.data?.error || err.message || 'Failed to preview report';\n      setError(errorMessage);\n      toast.error(errorMessage);\n      setPreviewData(null);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  return {\n    previewData,\n    loading,\n    error,\n    generatePreview\n  };\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}