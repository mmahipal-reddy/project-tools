{"ast":null,"code":"import React,{useState,useEffect}from'react';import{GripVertical}from'lucide-react';import apiClient from'../../../config/api';import toast from'react-hot-toast';import'../../../styles/ObjectBrowser.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ObjectBrowser=_ref=>{let{selectedObject,selectedObjects=[],// Array of already selected objects\nonObjectSelect,// Legacy: single object selection\nonObjectAdd,// New: add object to multi-object report\nonObjectRemove,// New: remove object\nonFieldDrag,searchTerm,multiObjectMode=false}=_ref;const[availableObjects,setAvailableObjects]=useState([]);const[availableFields,setAvailableFields]=useState([]);const[loading,setLoading]=useState(false);useEffect(()=>{loadAvailableObjects();},[]);useEffect(()=>{if(selectedObject){loadFieldsForObject(selectedObject);}else{setAvailableFields([]);}},[selectedObject]);const loadAvailableObjects=async()=>{try{const response=await apiClient.get('/update-object-fields/objects');if(response.data.success){setAvailableObjects(response.data.objects||[]);}}catch(error){console.error('Error loading objects:',error);}};const loadFieldsForObject=async objectType=>{setLoading(true);try{const response=await apiClient.get(\"/update-object-fields/fields/\".concat(encodeURIComponent(objectType),\"?forReporting=true\"));if(response.data.success){setAvailableFields(response.data.fields||[]);}}catch(error){console.error('Error loading fields:',error);toast.error('Failed to load fields');}finally{setLoading(false);}};const handleDragStart=(e,field)=>{e.dataTransfer.setData('application/json',JSON.stringify({type:'field',field:field,sourceObjectType:selectedObject// Include which object this field belongs to\n}));e.dataTransfer.effectAllowed='move';};const filteredFields=availableFields.filter(field=>{var _field$label,_field$name;return searchTerm===''||((_field$label=field.label)===null||_field$label===void 0?void 0:_field$label.toLowerCase().includes(searchTerm.toLowerCase()))||((_field$name=field.name)===null||_field$name===void 0?void 0:_field$name.toLowerCase().includes(searchTerm.toLowerCase()));});const handleObjectChange=objectType=>{if(multiObjectMode&&onObjectAdd){// In multi-object mode, add the object instead of replacing\nif(objectType&&!selectedObjects.includes(objectType)){onObjectAdd(objectType);// Also call onObjectSelect to update the current object for field viewing\nif(onObjectSelect){onObjectSelect(objectType);}}}else if(onObjectSelect){// Legacy single-object mode\nonObjectSelect(objectType);}};// Filter out already selected objects in multi-object mode\nconst availableObjectsList=multiObjectMode?availableObjects.filter(obj=>!selectedObjects.includes(obj.value)):availableObjects;return/*#__PURE__*/_jsxs(\"div\",{className:\"object-browser\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"object-selector\",children:[/*#__PURE__*/_jsxs(\"select\",{value:multiObjectMode?'':selectedObject||'',onChange:e=>handleObjectChange(e.target.value),className:\"object-select-input\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:multiObjectMode?'Add Object to Report':'Select Object'}),availableObjectsList.map(obj=>/*#__PURE__*/_jsx(\"option\",{value:obj.value,children:obj.label},obj.value))]}),multiObjectMode&&/*#__PURE__*/_jsx(\"div\",{className:\"multi-object-hint\",children:\"Select an object to add it to your report. You can add multiple objects.\"})]}),selectedObject?/*#__PURE__*/_jsxs(\"div\",{className:\"fields-list\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fields-list-header\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"fields-list-title\",children:[\"Fields for: \",selectedObject]})}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"fields-loading\",children:\"Loading fields...\"}):filteredFields.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"fields-empty\",children:\"No fields found\"}):filteredFields.map(field=>/*#__PURE__*/_jsxs(\"div\",{className:\"field-item\",draggable:true,onDragStart:e=>handleDragStart(e,field),children:[/*#__PURE__*/_jsx(GripVertical,{size:14,className:\"drag-handle\"}),/*#__PURE__*/_jsx(\"span\",{className:\"field-label\",children:field.label||field.name})]},field.name))]}):multiObjectMode&&selectedObjects.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"fields-empty\",children:\"Select an object from the list above or choose one from \\\"Selected Objects\\\" to view its fields.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"fields-empty\",children:\"Select an object to view its fields.\"})]});};export default ObjectBrowser;","map":{"version":3,"names":["React","useState","useEffect","GripVertical","apiClient","toast","jsx","_jsx","jsxs","_jsxs","ObjectBrowser","_ref","selectedObject","selectedObjects","onObjectSelect","onObjectAdd","onObjectRemove","onFieldDrag","searchTerm","multiObjectMode","availableObjects","setAvailableObjects","availableFields","setAvailableFields","loading","setLoading","loadAvailableObjects","loadFieldsForObject","response","get","data","success","objects","error","console","objectType","concat","encodeURIComponent","fields","handleDragStart","e","field","dataTransfer","setData","JSON","stringify","type","sourceObjectType","effectAllowed","filteredFields","filter","_field$label","_field$name","label","toLowerCase","includes","name","handleObjectChange","availableObjectsList","obj","value","className","children","onChange","target","map","length","draggable","onDragStart","size"],"sources":["/Users/mmoola/Cursor/ProjectSetup/client/src/components/AdvancedReportBuilder/ObjectPanel/ObjectBrowser.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { GripVertical } from 'lucide-react';\nimport apiClient from '../../../config/api';\nimport toast from 'react-hot-toast';\nimport '../../../styles/ObjectBrowser.css';\n\nconst ObjectBrowser = ({ \n  selectedObject, \n  selectedObjects = [], // Array of already selected objects\n  onObjectSelect, // Legacy: single object selection\n  onObjectAdd, // New: add object to multi-object report\n  onObjectRemove, // New: remove object\n  onFieldDrag, \n  searchTerm,\n  multiObjectMode = false \n}) => {\n  const [availableObjects, setAvailableObjects] = useState([]);\n  const [availableFields, setAvailableFields] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    loadAvailableObjects();\n  }, []);\n\n  useEffect(() => {\n    if (selectedObject) {\n      loadFieldsForObject(selectedObject);\n    } else {\n      setAvailableFields([]);\n    }\n  }, [selectedObject]);\n\n  const loadAvailableObjects = async () => {\n    try {\n      const response = await apiClient.get('/update-object-fields/objects');\n      if (response.data.success) {\n        setAvailableObjects(response.data.objects || []);\n      }\n    } catch (error) {\n      console.error('Error loading objects:', error);\n    }\n  };\n\n  const loadFieldsForObject = async (objectType) => {\n    setLoading(true);\n    try {\n      const response = await apiClient.get(\n        `/update-object-fields/fields/${encodeURIComponent(objectType)}?forReporting=true`\n      );\n      if (response.data.success) {\n        setAvailableFields(response.data.fields || []);\n      }\n    } catch (error) {\n      console.error('Error loading fields:', error);\n      toast.error('Failed to load fields');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDragStart = (e, field) => {\n    e.dataTransfer.setData('application/json', JSON.stringify({\n      type: 'field',\n      field: field,\n      sourceObjectType: selectedObject // Include which object this field belongs to\n    }));\n    e.dataTransfer.effectAllowed = 'move';\n  };\n\n  const filteredFields = availableFields.filter(field =>\n    searchTerm === '' ||\n    field.label?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    field.name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleObjectChange = (objectType) => {\n    if (multiObjectMode && onObjectAdd) {\n      // In multi-object mode, add the object instead of replacing\n      if (objectType && !selectedObjects.includes(objectType)) {\n        onObjectAdd(objectType);\n        // Also call onObjectSelect to update the current object for field viewing\n        if (onObjectSelect) {\n          onObjectSelect(objectType);\n        }\n      }\n    } else if (onObjectSelect) {\n      // Legacy single-object mode\n      onObjectSelect(objectType);\n    }\n  };\n\n  // Filter out already selected objects in multi-object mode\n  const availableObjectsList = multiObjectMode \n    ? availableObjects.filter(obj => !selectedObjects.includes(obj.value))\n    : availableObjects;\n\n  return (\n    <div className=\"object-browser\">\n      {/* Object Selector */}\n      <div className=\"object-selector\">\n        <select\n          value={multiObjectMode ? '' : (selectedObject || '')}\n          onChange={(e) => handleObjectChange(e.target.value)}\n          className=\"object-select-input\"\n        >\n          <option value=\"\">{multiObjectMode ? 'Add Object to Report' : 'Select Object'}</option>\n          {availableObjectsList.map(obj => (\n            <option key={obj.value} value={obj.value}>\n              {obj.label}\n            </option>\n          ))}\n        </select>\n        {multiObjectMode && (\n          <div className=\"multi-object-hint\">\n            Select an object to add it to your report. You can add multiple objects.\n          </div>\n        )}\n      </div>\n\n      {/* Fields List */}\n      {selectedObject ? (\n        <div className=\"fields-list\">\n          <div className=\"fields-list-header\">\n            <span className=\"fields-list-title\">Fields for: {selectedObject}</span>\n          </div>\n          {loading ? (\n            <div className=\"fields-loading\">Loading fields...</div>\n          ) : filteredFields.length === 0 ? (\n            <div className=\"fields-empty\">No fields found</div>\n          ) : (\n            filteredFields.map(field => (\n              <div\n                key={field.name}\n                className=\"field-item\"\n                draggable\n                onDragStart={(e) => handleDragStart(e, field)}\n              >\n                <GripVertical size={14} className=\"drag-handle\" />\n                <span className=\"field-label\">{field.label || field.name}</span>\n              </div>\n            ))\n          )}\n        </div>\n      ) : multiObjectMode && selectedObjects.length > 0 ? (\n        <div className=\"fields-empty\">\n          Select an object from the list above or choose one from \"Selected Objects\" to view its fields.\n        </div>\n      ) : (\n        <div className=\"fields-empty\">\n          Select an object to view its fields.\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ObjectBrowser;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}