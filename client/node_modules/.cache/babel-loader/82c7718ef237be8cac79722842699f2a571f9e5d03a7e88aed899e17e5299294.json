{"ast":null,"code":"var _jsxFileName = \"/Users/mmoola/Documents/GitHub/project-tools/client/src/pages/ProjectManagement/PMApprovals/PMApprovals.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useAuth } from '../../../context/AuthContext';\nimport Sidebar from '../../../components/Sidebar';\nimport useSidebarWidth from '../../../hooks/useSidebarWidth';\nimport { Menu, LogOut, RefreshCw, Loader } from 'lucide-react';\nimport apiClient from '../../../config/api';\nimport toast from 'react-hot-toast';\nimport BookmarkButton from '../../../components/BookmarkButton';\nimport DeadlinesPanel from './components/DeadlinesPanel';\nimport RecordsCount from './components/RecordsCount';\nimport FilterPanel from './components/FilterPanel';\nimport PendingHoursCard from './components/PendingHoursCard';\nimport MetricsRow from './components/MetricsRow';\nimport PendingUnitsCard from './components/PendingUnitsCard';\nimport ApprovalsTable from './components/ApprovalsTable';\nimport ActionButtons from './components/ActionButtons';\nimport ApprovalModal from './components/ApprovalModal';\nimport RejectModal from './components/RejectModal';\nimport EmailModal from './components/EmailModal';\nimport './PMApprovals.css';\nimport '../../../styles/Sidebar.css';\nimport '../../../styles/GlobalHeader.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PMApprovals = () => {\n  _s();\n  const {\n    user,\n    logout\n  } = useAuth();\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const sidebarWidth = useSidebarWidth(sidebarOpen);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n\n  // Data states\n  const [records, setRecords] = useState([]);\n  const [summary, setSummary] = useState(null);\n  const [deadlines, setDeadlines] = useState(null);\n  const [filterOptions, setFilterOptions] = useState({\n    accounts: [],\n    projects: [],\n    projectObjectives: [],\n    emails: []\n  });\n\n  // Filter states\n  const [filters, setFilters] = useState({\n    account: 'all',\n    project: 'all',\n    projectObjective: 'all',\n    email: 'all',\n    transactionDateFrom: '',\n    transactionDateTo: '',\n    weekendingDateFrom: '',\n    weekendingDateTo: '',\n    transactionId: ''\n  });\n\n  // Table states\n  const [offset, setOffset] = useState(0);\n  const [hasMore, setHasMore] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [totalRecords, setTotalRecords] = useState(0);\n  const [uniqueRecordsCount, setUniqueRecordsCount] = useState(0);\n  const [duplicatesCount, setDuplicatesCount] = useState(0);\n  const [sortBy, setSortBy] = useState('Transaction_Date__c');\n  const [sortOrder, setSortOrder] = useState('DESC');\n  const [selectedRows, setSelectedRows] = useState([]);\n\n  // Modal states\n  const [showApprovalModal, setShowApprovalModal] = useState(false);\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [showEmailModal, setShowEmailModal] = useState(false);\n\n  // Track if warning has been shown to avoid duplicates\n  const warningShownRef = useRef(false);\n\n  // Track if auto-loading is in progress\n  const autoLoadingRef = useRef(false);\n\n  // Track current records to avoid stale closures\n  const recordsRef = useRef([]);\n\n  // Map-based record storage for O(1) lookup and guaranteed uniqueness\n  const recordsMapRef = useRef(new Map());\n\n  // Track total unique records loaded (for display and comparison)\n  const uniqueRecordsCountRef = useRef(0);\n\n  // Track total duplicates filtered out across all batches\n  const totalDuplicatesRef = useRef(0);\n\n  // Track total records received from server (including duplicates)\n  const totalRecordsReceivedRef = useRef(0);\n  const tableContainerRef = useRef(null);\n\n  // Keep recordsRef and recordsMapRef in sync with records state\n  useEffect(() => {\n    // Ensure records is always an array\n    const recordsArray = Array.isArray(records) ? records : [];\n    recordsRef.current = recordsArray;\n    // Update map whenever records change\n    const newMap = new Map();\n    recordsArray.forEach(record => {\n      if (record && record.id) {\n        newMap.set(record.id, record);\n      }\n    });\n    recordsMapRef.current = newMap;\n  }, [records]);\n\n  // Fetch deadlines\n  const fetchDeadlines = useCallback(async () => {\n    try {\n      const response = await apiClient.get('/pm-approvals/deadlines');\n      if (response.data.success) {\n        setDeadlines(response.data.deadlines);\n      }\n    } catch (error) {\n      console.error('Error fetching deadlines:', error);\n    }\n  }, []);\n\n  // Fetch filter options\n  const fetchFilterOptions = useCallback(async () => {\n    try {\n      console.log('Fetching filter options...');\n      const response = await apiClient.get('/pm-approvals/filters');\n      console.log('Filter options response:', response.data);\n      if (response.data.success) {\n        // Ensure all filter arrays are actually arrays (defensive check)\n        const filters = response.data.filters || {};\n        const ensureArray = value => {\n          if (Array.isArray(value)) return value;\n          if (value && typeof value === 'object' && value.constructor === Set) {\n            // If it's a Set, convert to array\n            return Array.from(value);\n          }\n          return [];\n        };\n        const filterData = {\n          accounts: ensureArray(filters.accounts),\n          projects: ensureArray(filters.projects),\n          projectObjectives: ensureArray(filters.projectObjectives),\n          emails: ensureArray(filters.emails)\n        };\n        console.log('Setting filter options:', {\n          accountsCount: filterData.accounts.length,\n          projectsCount: filterData.projects.length,\n          projectObjectivesCount: filterData.projectObjectives.length,\n          emailsCount: filterData.emails.length\n        });\n        setFilterOptions(filterData);\n        if (response.data.warning && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      } else {\n        console.error('Filter options API returned success: false', response.data);\n      }\n    } catch (error) {\n      console.error('Error fetching filter options:', error);\n      setFilterOptions({\n        accounts: [],\n        projects: [],\n        projectObjectives: [],\n        emails: []\n      });\n    }\n  }, []);\n\n  // Fetch summary metrics\n  const fetchSummary = useCallback(async (silent = false) => {\n    try {\n      const params = new URLSearchParams();\n      Object.keys(filters).forEach(key => {\n        if (filters[key] && filters[key] !== 'all' && filters[key] !== '') {\n          params.append(key, filters[key]);\n        }\n      });\n      const response = await apiClient.get(`/pm-approvals/summary?${params.toString()}`);\n      if (response.data.success) {\n        setSummary(response.data.data);\n        if (response.data.warning && !silent && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error fetching summary:', error);\n      if (!silent && error.code !== 'ECONNREFUSED' && error.code !== 'ERR_NETWORK' && !error.isBackendDown) {\n        toast.error('Failed to load summary metrics');\n      }\n    }\n  }, [filters]);\n\n  // Simplified fetch records function - loads 5000 records per batch\n  const fetchRecords = useCallback(async (reset = false, startOffset = null) => {\n    // Prevent concurrent fetches\n    if (autoLoadingRef.current && !reset) {\n      return;\n    }\n    autoLoadingRef.current = true;\n    if (reset) {\n      setLoading(true);\n      setRecords([]);\n      recordsRef.current = [];\n      recordsMapRef.current = new Map(); // Reset map\n      uniqueRecordsCountRef.current = 0; // Reset unique count\n      totalDuplicatesRef.current = 0; // Reset duplicates count\n      totalRecordsReceivedRef.current = 0; // Reset total received\n      setOffset(0);\n      setTotalRecords(0);\n      setUniqueRecordsCount(0);\n      setDuplicatesCount(0);\n      setHasMore(true);\n      autoLoadingRef.current = false; // Allow reset to proceed\n    } else {\n      setLoadingMore(true);\n    }\n    try {\n      const currentOffset = startOffset !== null ? startOffset : offset;\n      const params = new URLSearchParams();\n      params.append('offset', currentOffset.toString());\n      params.append('limit', '5000'); // Request 5,000 records per batch\n      params.append('sortBy', sortBy);\n      params.append('sortOrder', sortOrder);\n      Object.keys(filters).forEach(key => {\n        if (filters[key] && filters[key] !== 'all' && filters[key] !== '') {\n          params.append(key, filters[key]);\n        }\n      });\n      const response = await apiClient.get(`/pm-approvals/list?${params.toString()}`);\n      if (response.data.success) {\n        // Ensure records is an array\n        const recordsData = response.data.records;\n        const newRecords = Array.isArray(recordsData) ? recordsData : [];\n        const total = response.data.total || 0;\n        const effectiveOffset = response.data.effectiveOffset !== undefined ? response.data.effectiveOffset : currentOffset + newRecords.length;\n        const hasMoreData = response.data.hasMore || false;\n        setTotalRecords(total);\n\n        // SYSTEMATIC DEDUPLICATION: Use Map-based approach for guaranteed uniqueness\n        if (reset) {\n          // Reset: Build new map from scratch\n          const recordsMap = new Map();\n          const uniqueRecords = [];\n          let duplicateCount = 0;\n          newRecords.forEach(record => {\n            if (record && record.id) {\n              // Only add if not already in map (guarantees uniqueness)\n              if (!recordsMap.has(record.id)) {\n                recordsMap.set(record.id, record);\n                uniqueRecords.push(record);\n              } else {\n                duplicateCount++;\n                console.warn(`Duplicate record detected during reset: ${record.id}`);\n              }\n            }\n          });\n          recordsMapRef.current = recordsMap;\n          setRecords(uniqueRecords);\n          recordsRef.current = uniqueRecords;\n          uniqueRecordsCountRef.current = uniqueRecords.length;\n          totalDuplicatesRef.current = duplicateCount;\n          totalRecordsReceivedRef.current = newRecords.length;\n          setUniqueRecordsCount(uniqueRecords.length);\n          setDuplicatesCount(duplicateCount);\n          setOffset(uniqueRecords.length);\n          if (newRecords.length !== uniqueRecords.length) {\n            console.warn(`Deduplication: ${newRecords.length} records received, ${uniqueRecords.length} unique records after deduplication, ${duplicateCount} duplicates filtered`);\n          }\n\n          // Check if we have more records to load (for reset case)\n          // Continue loading as long as server says hasMore=true, regardless of unique count\n          // This ensures we process all batches to find all unique records\n          const stillHasMoreReset = hasMoreData && newRecords.length > 0;\n          setHasMore(stillHasMoreReset);\n          console.log(`Batch loaded (reset): offset=0, received=${newRecords.length}, unique=${uniqueRecords.length}, totalUnique=${uniqueRecordsCountRef.current}, serverTotal=${total}, hasMore=${stillHasMoreReset}`);\n\n          // Auto-load next batch if server indicates more records available\n          // We continue loading even if all records in this batch were duplicates,\n          // because there might be more unique records in subsequent batches\n          if (stillHasMoreReset) {\n            setTimeout(() => {\n              fetchRecords(false, effectiveOffset).catch(err => {\n                console.error('Error auto-loading next batch:', err);\n                setHasMore(false);\n              });\n            }, 50); // Small delay to keep UI responsive\n          } else {\n            if (newRecords.length === 0) {\n              console.log('Stopping auto-load (reset): No records received from API');\n            } else {\n              console.log(`All records loaded (reset): Loaded ${uniqueRecordsCountRef.current} unique records from ${total} total records`);\n            }\n            setHasMore(false);\n          }\n        } else {\n          // Append: Use functional update with Map-based deduplication\n          let uniqueNewRecordsCount = 0;\n          setRecords(prev => {\n            // Get current map for O(1) lookup\n            const currentMap = recordsMapRef.current;\n            const uniqueNewRecords = [];\n            let duplicateCount = 0;\n            newRecords.forEach(record => {\n              if (record && record.id) {\n                if (!currentMap.has(record.id)) {\n                  // New record - add to map and list\n                  currentMap.set(record.id, record);\n                  uniqueNewRecords.push(record);\n                } else {\n                  // Duplicate detected\n                  duplicateCount++;\n                  console.warn(`Duplicate record detected during append: ${record.id}`);\n                }\n              }\n            });\n\n            // Track how many unique records were actually added\n            uniqueNewRecordsCount = uniqueNewRecords.length;\n\n            // Update total duplicates and total received\n            totalDuplicatesRef.current += duplicateCount;\n            totalRecordsReceivedRef.current += newRecords.length;\n            if (duplicateCount > 0) {\n              console.warn(`Deduplication: ${duplicateCount} duplicate(s) filtered out from ${newRecords.length} new records`);\n            }\n\n            // Build new array from map values to ensure no duplicates\n            const updatedRecords = Array.from(currentMap.values());\n            recordsMapRef.current = currentMap;\n            recordsRef.current = updatedRecords;\n            uniqueRecordsCountRef.current = updatedRecords.length; // Update unique count\n\n            // Update state for display\n            setUniqueRecordsCount(updatedRecords.length);\n            setDuplicatesCount(totalDuplicatesRef.current);\n            return updatedRecords;\n          });\n          setOffset(effectiveOffset);\n\n          // Check if we have more records to load\n          // IMPORTANT: Continue loading as long as server says hasMore=true\n          // This ensures we process all batches to find all unique records, even if\n          // some batches contain only duplicates\n          // Only stop if:\n          // 1. Server says hasMore=false (no more batches)\n          // 2. We received 0 records from API (end of data)\n          const stillHasMore = hasMoreData && newRecords.length > 0;\n          setHasMore(stillHasMore);\n          console.log(`Batch loaded: offset=${currentOffset}, received=${newRecords.length}, unique=${uniqueNewRecordsCount}, totalUnique=${uniqueRecordsCountRef.current}, effectiveOffset=${effectiveOffset}, serverTotal=${total}, hasMore=${stillHasMore}`);\n\n          // Auto-load next batch if server indicates more records available\n          // Continue loading even if all records in this batch were duplicates,\n          // because there might be more unique records in subsequent batches\n          if (stillHasMore) {\n            setTimeout(() => {\n              fetchRecords(false, effectiveOffset).catch(err => {\n                console.error('Error auto-loading next batch:', err);\n                setHasMore(false);\n              });\n            }, 50); // Small delay to keep UI responsive\n          } else {\n            if (newRecords.length === 0) {\n              console.log('Stopping auto-load: No records received from API');\n            } else {\n              console.log(`All records loaded: Loaded ${uniqueRecordsCountRef.current} unique records from ${total} total records`);\n            }\n            setHasMore(false);\n          }\n        }\n        if (response.data.warning && reset && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      } else {\n        toast.error(response.data.error || 'Failed to fetch approvals');\n        setHasMore(false);\n      }\n    } catch (error) {\n      console.error('Error fetching records:', error);\n      if (error.code !== 'ECONNREFUSED' && error.code !== 'ERR_NETWORK' && !error.isBackendDown) {\n        toast.error('Failed to fetch approvals');\n      }\n      setHasMore(false);\n    } finally {\n      setLoading(false);\n      setLoadingMore(false);\n      setRefreshing(false);\n      autoLoadingRef.current = false;\n    }\n  }, [filters, sortBy, sortOrder, offset]);\n\n  // Track if initial load has been done\n  const initialLoadDoneRef = useRef(false);\n\n  // Initial load - only runs once on mount\n  useEffect(() => {\n    if (!initialLoadDoneRef.current) {\n      initialLoadDoneRef.current = true;\n      fetchDeadlines();\n      fetchFilterOptions();\n      fetchSummary(true);\n      fetchRecords(true);\n    }\n  }, [fetchDeadlines, fetchFilterOptions, fetchSummary, fetchRecords]);\n\n  // Note: Filters and sort changes no longer trigger data reset\n  // Data persists during the session and only reloads when refresh button is clicked\n\n  const handleRefresh = useCallback(e => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setRefreshing(true);\n    setOffset(0);\n    setRecords([]);\n    recordsRef.current = [];\n    setHasMore(true);\n    setSelectedRows([]);\n    setTotalRecords(0);\n    warningShownRef.current = false;\n    autoLoadingRef.current = false;\n    fetchRecords(true).finally(() => {\n      setRefreshing(false);\n    });\n    fetchSummary();\n    fetchFilterOptions();\n  }, [fetchRecords, fetchSummary, fetchFilterOptions]);\n  const handleFilterChange = newFilters => {\n    setFilters(newFilters);\n  };\n  const handleClearFilters = clearedFilters => {\n    setFilters(clearedFilters);\n  };\n  const handleSort = (column, order) => {\n    setSortBy(column);\n    setSortOrder(order);\n  };\n  const handleRowSelect = recordId => {\n    setSelectedRows(prev => {\n      if (prev.includes(recordId)) {\n        return prev.filter(id => id !== recordId);\n      } else {\n        return [...prev, recordId];\n      }\n    });\n  };\n  const handleApprove = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to approve');\n      return;\n    }\n    setShowApprovalModal(true);\n  };\n  const handleReject = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to reject');\n      return;\n    }\n    setShowRejectModal(true);\n  };\n  const handleSendEmail = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to email');\n      return;\n    }\n    setShowEmailModal(true);\n  };\n  const handleApprovalConfirm = async comment => {\n    try {\n      const response = await apiClient.post('/pm-approvals/approve', {\n        transactionIds: selectedRows,\n        comment: comment || ''\n      });\n      if (response.data.success) {\n        toast.success(`Successfully approved ${response.data.approved} record(s)`);\n        setRecords(prev => {\n          const filtered = prev.filter(r => !selectedRows.includes(r.id));\n          // Update map to match filtered records\n          const newMap = new Map();\n          filtered.forEach(record => {\n            if (record && record.id) {\n              newMap.set(record.id, record);\n            }\n          });\n          recordsMapRef.current = newMap;\n          recordsRef.current = filtered;\n          return filtered;\n        });\n        setSelectedRows([]);\n        setShowApprovalModal(false);\n        fetchSummary();\n      } else {\n        toast.error(response.data.error || 'Failed to approve records');\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      toast.error(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'Failed to approve records');\n    }\n  };\n  const handleRejectConfirm = async reason => {\n    try {\n      const response = await apiClient.post('/pm-approvals/reject', {\n        transactionIds: selectedRows,\n        reason: reason || ''\n      });\n      if (response.data.success) {\n        toast.success(`Successfully rejected ${response.data.rejected} record(s)`);\n        setRecords(prev => {\n          const filtered = prev.filter(r => !selectedRows.includes(r.id));\n          // Update map to match filtered records\n          const newMap = new Map();\n          filtered.forEach(record => {\n            if (record && record.id) {\n              newMap.set(record.id, record);\n            }\n          });\n          recordsMapRef.current = newMap;\n          recordsRef.current = filtered;\n          return filtered;\n        });\n        setSelectedRows([]);\n        setShowRejectModal(false);\n        fetchSummary();\n      } else {\n        toast.error(response.data.error || 'Failed to reject records');\n      }\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      toast.error(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.error) || 'Failed to reject records');\n    }\n  };\n  const handleEmailConfirm = async emailData => {\n    toast.info('Email functionality coming soon');\n    setShowEmailModal(false);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"dashboard-layout\",\n    children: [/*#__PURE__*/_jsxDEV(Sidebar, {\n      isOpen: sidebarOpen,\n      toggleSidebar: () => setSidebarOpen(!sidebarOpen)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 600,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pm-approvals-page\",\n      style: {\n        marginLeft: `${sidebarWidth}px`,\n        width: `calc(100% - ${sidebarWidth}px)`,\n        transition: 'margin-left 0.2s ease, width 0.2s ease'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pm-approvals-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pm-approvals-header\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header-content\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"header-left\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"header-menu-toggle\",\n                onClick: () => setSidebarOpen(!sidebarOpen),\n                \"aria-label\": \"Toggle sidebar\",\n                children: /*#__PURE__*/_jsxDEV(Menu, {\n                  size: 20\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 620,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 615,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                  className: \"page-title\",\n                  children: \"PM Approvals for Self Reported Time\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 623,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 622,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 614,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"header-right\",\n              children: [/*#__PURE__*/_jsxDEV(BookmarkButton, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 627,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"refresh-btn\",\n                onClick: handleRefresh,\n                disabled: refreshing,\n                title: \"Refresh\",\n                children: /*#__PURE__*/_jsxDEV(RefreshCw, {\n                  size: 18,\n                  className: refreshing ? 'spinning' : ''\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 634,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 628,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"header-user-profile\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"user-profile\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"user-avatar\",\n                    children: ((user === null || user === void 0 ? void 0 : user.email) || 'U').charAt(0).toUpperCase()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 638,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"user-name\",\n                    children: (user === null || user === void 0 ? void 0 : user.email) || 'User'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 641,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"logout-btn\",\n                    onClick: logout,\n                    title: \"Logout\",\n                    children: /*#__PURE__*/_jsxDEV(LogOut, {\n                      size: 18\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 643,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 642,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 637,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 636,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 626,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 612,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pm-approvals-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-approvals-sidebar\",\n            children: [/*#__PURE__*/_jsxDEV(DeadlinesPanel, {\n              deadlines: deadlines,\n              loading: !deadlines\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 655,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(RecordsCount, {\n              count: uniqueRecordsCount > 0 ? uniqueRecordsCount : records.length,\n              total: uniqueRecordsCount > 0 ? uniqueRecordsCount : records.length,\n              duplicates: duplicatesCount || 0,\n              loading: loading,\n              isLoadingMore: loadingMore || hasMore\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 656,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(FilterPanel, {\n              filters: filters,\n              onFilterChange: handleFilterChange,\n              onClearFilters: handleClearFilters,\n              filterOptions: filterOptions,\n              loading: loading\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 663,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ActionButtons, {\n              onApprove: handleApprove,\n              onReject: handleReject,\n              onSendEmail: handleSendEmail,\n              disabled: loading,\n              selectedCount: selectedRows.length\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 670,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 654,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pm-approvals-main\",\n            ref: tableContainerRef,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"summary-metrics-section\",\n              children: [/*#__PURE__*/_jsxDEV(PendingHoursCard, {\n                totalPendingHours: (summary === null || summary === void 0 ? void 0 : summary.totalPendingHours) || 0,\n                totalHours: (summary === null || summary === void 0 ? void 0 : summary.totalHours) || 0\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 683,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(MetricsRow, {\n                selfReportedTime: (summary === null || summary === void 0 ? void 0 : summary.selfReportedTime) || 0,\n                systemTracked: (summary === null || summary === void 0 ? void 0 : summary.systemTracked) || 0,\n                payment: (summary === null || summary === void 0 ? void 0 : summary.totalPayment) || 0\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 687,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(PendingUnitsCard, {\n                totalPendingUnits: (summary === null || summary === void 0 ? void 0 : summary.totalPendingUnits) || 0\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 692,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 682,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"approvals-table-section\",\n              children: /*#__PURE__*/_jsxDEV(ApprovalsTable, {\n                records: Array.isArray(records) ? records : [],\n                loading: loading,\n                onRowClick: record => console.log('Row clicked:', record),\n                onSort: handleSort,\n                sortBy: sortBy,\n                sortOrder: sortOrder,\n                selectedRows: selectedRows,\n                onRowSelect: handleRowSelect\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 699,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 698,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 680,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 652,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 610,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 602,\n      columnNumber: 7\n    }, this), showApprovalModal && /*#__PURE__*/_jsxDEV(ApprovalModal, {\n      selectedCount: selectedRows.length,\n      onConfirm: handleApprovalConfirm,\n      onClose: () => setShowApprovalModal(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 717,\n      columnNumber: 9\n    }, this), showRejectModal && /*#__PURE__*/_jsxDEV(RejectModal, {\n      selectedCount: selectedRows.length,\n      onConfirm: handleRejectConfirm,\n      onClose: () => setShowRejectModal(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 724,\n      columnNumber: 9\n    }, this), showEmailModal && /*#__PURE__*/_jsxDEV(EmailModal, {\n      selectedCount: selectedRows.length,\n      onConfirm: handleEmailConfirm,\n      onClose: () => setShowEmailModal(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 731,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 599,\n    columnNumber: 5\n  }, this);\n};\n_s(PMApprovals, \"YIwDHWb5uVTbF/yjWSxNBR9YgqE=\", false, function () {\n  return [useAuth, useSidebarWidth];\n});\n_c = PMApprovals;\nexport default PMApprovals;\nvar _c;\n$RefreshReg$(_c, \"PMApprovals\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useAuth","Sidebar","useSidebarWidth","Menu","LogOut","RefreshCw","Loader","apiClient","toast","BookmarkButton","DeadlinesPanel","RecordsCount","FilterPanel","PendingHoursCard","MetricsRow","PendingUnitsCard","ApprovalsTable","ActionButtons","ApprovalModal","RejectModal","EmailModal","jsxDEV","_jsxDEV","PMApprovals","_s","user","logout","sidebarOpen","setSidebarOpen","sidebarWidth","loading","setLoading","refreshing","setRefreshing","records","setRecords","summary","setSummary","deadlines","setDeadlines","filterOptions","setFilterOptions","accounts","projects","projectObjectives","emails","filters","setFilters","account","project","projectObjective","email","transactionDateFrom","transactionDateTo","weekendingDateFrom","weekendingDateTo","transactionId","offset","setOffset","hasMore","setHasMore","loadingMore","setLoadingMore","totalRecords","setTotalRecords","uniqueRecordsCount","setUniqueRecordsCount","duplicatesCount","setDuplicatesCount","sortBy","setSortBy","sortOrder","setSortOrder","selectedRows","setSelectedRows","showApprovalModal","setShowApprovalModal","showRejectModal","setShowRejectModal","showEmailModal","setShowEmailModal","warningShownRef","autoLoadingRef","recordsRef","recordsMapRef","Map","uniqueRecordsCountRef","totalDuplicatesRef","totalRecordsReceivedRef","tableContainerRef","recordsArray","Array","isArray","current","newMap","forEach","record","id","set","fetchDeadlines","response","get","data","success","error","console","fetchFilterOptions","log","ensureArray","value","constructor","Set","from","filterData","accountsCount","length","projectsCount","projectObjectivesCount","emailsCount","warning","duration","icon","style","background","color","border","fetchSummary","silent","params","URLSearchParams","Object","keys","key","append","toString","code","isBackendDown","fetchRecords","reset","startOffset","currentOffset","recordsData","newRecords","total","effectiveOffset","undefined","hasMoreData","recordsMap","uniqueRecords","duplicateCount","has","push","warn","stillHasMoreReset","setTimeout","catch","err","uniqueNewRecordsCount","prev","currentMap","uniqueNewRecords","updatedRecords","values","stillHasMore","initialLoadDoneRef","handleRefresh","e","preventDefault","stopPropagation","finally","handleFilterChange","newFilters","handleClearFilters","clearedFilters","handleSort","column","order","handleRowSelect","recordId","includes","filter","handleApprove","handleReject","handleSendEmail","handleApprovalConfirm","comment","post","transactionIds","approved","filtered","r","_error$response","_error$response$data","handleRejectConfirm","reason","rejected","_error$response2","_error$response2$data","handleEmailConfirm","emailData","info","className","children","isOpen","toggleSidebar","fileName","_jsxFileName","lineNumber","columnNumber","marginLeft","width","transition","onClick","size","disabled","title","charAt","toUpperCase","count","duplicates","isLoadingMore","onFilterChange","onClearFilters","onApprove","onReject","onSendEmail","selectedCount","ref","totalPendingHours","totalHours","selfReportedTime","systemTracked","payment","totalPayment","totalPendingUnits","onRowClick","onSort","onRowSelect","onConfirm","onClose","_c","$RefreshReg$"],"sources":["/Users/mmoola/Documents/GitHub/project-tools/client/src/pages/ProjectManagement/PMApprovals/PMApprovals.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useAuth } from '../../../context/AuthContext';\nimport Sidebar from '../../../components/Sidebar';\nimport useSidebarWidth from '../../../hooks/useSidebarWidth';\nimport { Menu, LogOut, RefreshCw, Loader } from 'lucide-react';\nimport apiClient from '../../../config/api';\nimport toast from 'react-hot-toast';\nimport BookmarkButton from '../../../components/BookmarkButton';\nimport DeadlinesPanel from './components/DeadlinesPanel';\nimport RecordsCount from './components/RecordsCount';\nimport FilterPanel from './components/FilterPanel';\nimport PendingHoursCard from './components/PendingHoursCard';\nimport MetricsRow from './components/MetricsRow';\nimport PendingUnitsCard from './components/PendingUnitsCard';\nimport ApprovalsTable from './components/ApprovalsTable';\nimport ActionButtons from './components/ActionButtons';\nimport ApprovalModal from './components/ApprovalModal';\nimport RejectModal from './components/RejectModal';\nimport EmailModal from './components/EmailModal';\nimport './PMApprovals.css';\nimport '../../../styles/Sidebar.css';\nimport '../../../styles/GlobalHeader.css';\n\nconst PMApprovals = () => {\n  const { user, logout } = useAuth();\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const sidebarWidth = useSidebarWidth(sidebarOpen);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  \n  // Data states\n  const [records, setRecords] = useState([]);\n  const [summary, setSummary] = useState(null);\n  const [deadlines, setDeadlines] = useState(null);\n  const [filterOptions, setFilterOptions] = useState({\n    accounts: [],\n    projects: [],\n    projectObjectives: [],\n    emails: []\n  });\n  \n  // Filter states\n  const [filters, setFilters] = useState({\n    account: 'all',\n    project: 'all',\n    projectObjective: 'all',\n    email: 'all',\n    transactionDateFrom: '',\n    transactionDateTo: '',\n    weekendingDateFrom: '',\n    weekendingDateTo: '',\n    transactionId: ''\n  });\n  \n  // Table states\n  const [offset, setOffset] = useState(0);\n  const [hasMore, setHasMore] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [totalRecords, setTotalRecords] = useState(0);\n  const [uniqueRecordsCount, setUniqueRecordsCount] = useState(0);\n  const [duplicatesCount, setDuplicatesCount] = useState(0);\n  const [sortBy, setSortBy] = useState('Transaction_Date__c');\n  const [sortOrder, setSortOrder] = useState('DESC');\n  const [selectedRows, setSelectedRows] = useState([]);\n  \n  // Modal states\n  const [showApprovalModal, setShowApprovalModal] = useState(false);\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [showEmailModal, setShowEmailModal] = useState(false);\n  \n  // Track if warning has been shown to avoid duplicates\n  const warningShownRef = useRef(false);\n  \n  // Track if auto-loading is in progress\n  const autoLoadingRef = useRef(false);\n  \n  // Track current records to avoid stale closures\n  const recordsRef = useRef([]);\n  \n  // Map-based record storage for O(1) lookup and guaranteed uniqueness\n  const recordsMapRef = useRef(new Map());\n  \n  // Track total unique records loaded (for display and comparison)\n  const uniqueRecordsCountRef = useRef(0);\n  \n  // Track total duplicates filtered out across all batches\n  const totalDuplicatesRef = useRef(0);\n  \n  // Track total records received from server (including duplicates)\n  const totalRecordsReceivedRef = useRef(0);\n  \n  const tableContainerRef = useRef(null);\n  \n  // Keep recordsRef and recordsMapRef in sync with records state\n  useEffect(() => {\n    // Ensure records is always an array\n    const recordsArray = Array.isArray(records) ? records : [];\n    recordsRef.current = recordsArray;\n    // Update map whenever records change\n    const newMap = new Map();\n    recordsArray.forEach(record => {\n      if (record && record.id) {\n        newMap.set(record.id, record);\n      }\n    });\n    recordsMapRef.current = newMap;\n  }, [records]);\n\n  // Fetch deadlines\n  const fetchDeadlines = useCallback(async () => {\n    try {\n      const response = await apiClient.get('/pm-approvals/deadlines');\n      if (response.data.success) {\n        setDeadlines(response.data.deadlines);\n      }\n    } catch (error) {\n      console.error('Error fetching deadlines:', error);\n    }\n  }, []);\n\n  // Fetch filter options\n  const fetchFilterOptions = useCallback(async () => {\n    try {\n      console.log('Fetching filter options...');\n      const response = await apiClient.get('/pm-approvals/filters');\n      console.log('Filter options response:', response.data);\n      \n      if (response.data.success) {\n        // Ensure all filter arrays are actually arrays (defensive check)\n        const filters = response.data.filters || {};\n        const ensureArray = (value) => {\n          if (Array.isArray(value)) return value;\n          if (value && typeof value === 'object' && value.constructor === Set) {\n            // If it's a Set, convert to array\n            return Array.from(value);\n          }\n          return [];\n        };\n\n        const filterData = {\n          accounts: ensureArray(filters.accounts),\n          projects: ensureArray(filters.projects),\n          projectObjectives: ensureArray(filters.projectObjectives),\n          emails: ensureArray(filters.emails)\n        };\n\n        console.log('Setting filter options:', {\n          accountsCount: filterData.accounts.length,\n          projectsCount: filterData.projects.length,\n          projectObjectivesCount: filterData.projectObjectives.length,\n          emailsCount: filterData.emails.length\n        });\n\n        setFilterOptions(filterData);\n        \n        if (response.data.warning && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      } else {\n        console.error('Filter options API returned success: false', response.data);\n      }\n    } catch (error) {\n      console.error('Error fetching filter options:', error);\n      setFilterOptions({\n        accounts: [],\n        projects: [],\n        projectObjectives: [],\n        emails: []\n      });\n    }\n  }, []);\n\n  // Fetch summary metrics\n  const fetchSummary = useCallback(async (silent = false) => {\n    try {\n      const params = new URLSearchParams();\n      Object.keys(filters).forEach(key => {\n        if (filters[key] && filters[key] !== 'all' && filters[key] !== '') {\n          params.append(key, filters[key]);\n        }\n      });\n      \n      const response = await apiClient.get(`/pm-approvals/summary?${params.toString()}`);\n      if (response.data.success) {\n        setSummary(response.data.data);\n        \n        if (response.data.warning && !silent && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Error fetching summary:', error);\n      if (!silent && error.code !== 'ECONNREFUSED' && error.code !== 'ERR_NETWORK' && !error.isBackendDown) {\n        toast.error('Failed to load summary metrics');\n      }\n    }\n  }, [filters]);\n\n  // Simplified fetch records function - loads 5000 records per batch\n  const fetchRecords = useCallback(async (reset = false, startOffset = null) => {\n    // Prevent concurrent fetches\n    if (autoLoadingRef.current && !reset) {\n      return;\n    }\n    \n    autoLoadingRef.current = true;\n    \n    if (reset) {\n      setLoading(true);\n      setRecords([]);\n      recordsRef.current = [];\n      recordsMapRef.current = new Map(); // Reset map\n      uniqueRecordsCountRef.current = 0; // Reset unique count\n      totalDuplicatesRef.current = 0; // Reset duplicates count\n      totalRecordsReceivedRef.current = 0; // Reset total received\n      setOffset(0);\n      setTotalRecords(0);\n      setUniqueRecordsCount(0);\n      setDuplicatesCount(0);\n      setHasMore(true);\n      autoLoadingRef.current = false; // Allow reset to proceed\n    } else {\n      setLoadingMore(true);\n    }\n\n    try {\n      const currentOffset = startOffset !== null ? startOffset : offset;\n      const params = new URLSearchParams();\n      params.append('offset', currentOffset.toString());\n      params.append('limit', '5000'); // Request 5,000 records per batch\n      params.append('sortBy', sortBy);\n      params.append('sortOrder', sortOrder);\n      \n      Object.keys(filters).forEach(key => {\n        if (filters[key] && filters[key] !== 'all' && filters[key] !== '') {\n          params.append(key, filters[key]);\n        }\n      });\n      \n      const response = await apiClient.get(`/pm-approvals/list?${params.toString()}`);\n      \n      if (response.data.success) {\n        // Ensure records is an array\n        const recordsData = response.data.records;\n        const newRecords = Array.isArray(recordsData) ? recordsData : [];\n        const total = response.data.total || 0;\n        const effectiveOffset = response.data.effectiveOffset !== undefined \n          ? response.data.effectiveOffset \n          : (currentOffset + newRecords.length);\n        const hasMoreData = response.data.hasMore || false;\n        \n        setTotalRecords(total);\n        \n        // SYSTEMATIC DEDUPLICATION: Use Map-based approach for guaranteed uniqueness\n        if (reset) {\n          // Reset: Build new map from scratch\n          const recordsMap = new Map();\n          const uniqueRecords = [];\n          let duplicateCount = 0;\n          \n          newRecords.forEach(record => {\n            if (record && record.id) {\n              // Only add if not already in map (guarantees uniqueness)\n              if (!recordsMap.has(record.id)) {\n                recordsMap.set(record.id, record);\n                uniqueRecords.push(record);\n              } else {\n                duplicateCount++;\n                console.warn(`Duplicate record detected during reset: ${record.id}`);\n              }\n            }\n          });\n          \n          recordsMapRef.current = recordsMap;\n          setRecords(uniqueRecords);\n          recordsRef.current = uniqueRecords;\n          uniqueRecordsCountRef.current = uniqueRecords.length;\n          totalDuplicatesRef.current = duplicateCount;\n          totalRecordsReceivedRef.current = newRecords.length;\n          setUniqueRecordsCount(uniqueRecords.length);\n          setDuplicatesCount(duplicateCount);\n          setOffset(uniqueRecords.length);\n          \n          if (newRecords.length !== uniqueRecords.length) {\n            console.warn(`Deduplication: ${newRecords.length} records received, ${uniqueRecords.length} unique records after deduplication, ${duplicateCount} duplicates filtered`);\n          }\n          \n          // Check if we have more records to load (for reset case)\n          // Continue loading as long as server says hasMore=true, regardless of unique count\n          // This ensures we process all batches to find all unique records\n          const stillHasMoreReset = hasMoreData && (newRecords.length > 0);\n          setHasMore(stillHasMoreReset);\n          \n          console.log(`Batch loaded (reset): offset=0, received=${newRecords.length}, unique=${uniqueRecords.length}, totalUnique=${uniqueRecordsCountRef.current}, serverTotal=${total}, hasMore=${stillHasMoreReset}`);\n          \n          // Auto-load next batch if server indicates more records available\n          // We continue loading even if all records in this batch were duplicates,\n          // because there might be more unique records in subsequent batches\n          if (stillHasMoreReset) {\n            setTimeout(() => {\n              fetchRecords(false, effectiveOffset).catch((err) => {\n                console.error('Error auto-loading next batch:', err);\n                setHasMore(false);\n              });\n            }, 50); // Small delay to keep UI responsive\n          } else {\n            if (newRecords.length === 0) {\n              console.log('Stopping auto-load (reset): No records received from API');\n            } else {\n              console.log(`All records loaded (reset): Loaded ${uniqueRecordsCountRef.current} unique records from ${total} total records`);\n            }\n            setHasMore(false);\n          }\n        } else {\n          // Append: Use functional update with Map-based deduplication\n          let uniqueNewRecordsCount = 0;\n          setRecords(prev => {\n            // Get current map for O(1) lookup\n            const currentMap = recordsMapRef.current;\n            const uniqueNewRecords = [];\n            let duplicateCount = 0;\n            \n            newRecords.forEach(record => {\n              if (record && record.id) {\n                if (!currentMap.has(record.id)) {\n                  // New record - add to map and list\n                  currentMap.set(record.id, record);\n                  uniqueNewRecords.push(record);\n                } else {\n                  // Duplicate detected\n                  duplicateCount++;\n                  console.warn(`Duplicate record detected during append: ${record.id}`);\n                }\n              }\n            });\n            \n            // Track how many unique records were actually added\n            uniqueNewRecordsCount = uniqueNewRecords.length;\n            \n            // Update total duplicates and total received\n            totalDuplicatesRef.current += duplicateCount;\n            totalRecordsReceivedRef.current += newRecords.length;\n            \n            if (duplicateCount > 0) {\n              console.warn(`Deduplication: ${duplicateCount} duplicate(s) filtered out from ${newRecords.length} new records`);\n            }\n            \n            // Build new array from map values to ensure no duplicates\n            const updatedRecords = Array.from(currentMap.values());\n            recordsMapRef.current = currentMap;\n            recordsRef.current = updatedRecords;\n            uniqueRecordsCountRef.current = updatedRecords.length; // Update unique count\n            \n            // Update state for display\n            setUniqueRecordsCount(updatedRecords.length);\n            setDuplicatesCount(totalDuplicatesRef.current);\n            \n            return updatedRecords;\n          });\n          setOffset(effectiveOffset);\n          \n          // Check if we have more records to load\n          // IMPORTANT: Continue loading as long as server says hasMore=true\n          // This ensures we process all batches to find all unique records, even if\n          // some batches contain only duplicates\n          // Only stop if:\n          // 1. Server says hasMore=false (no more batches)\n          // 2. We received 0 records from API (end of data)\n          const stillHasMore = hasMoreData && (newRecords.length > 0);\n          setHasMore(stillHasMore);\n          \n          console.log(`Batch loaded: offset=${currentOffset}, received=${newRecords.length}, unique=${uniqueNewRecordsCount}, totalUnique=${uniqueRecordsCountRef.current}, effectiveOffset=${effectiveOffset}, serverTotal=${total}, hasMore=${stillHasMore}`);\n          \n          // Auto-load next batch if server indicates more records available\n          // Continue loading even if all records in this batch were duplicates,\n          // because there might be more unique records in subsequent batches\n          if (stillHasMore) {\n            setTimeout(() => {\n              fetchRecords(false, effectiveOffset).catch((err) => {\n                console.error('Error auto-loading next batch:', err);\n                setHasMore(false);\n              });\n            }, 50); // Small delay to keep UI responsive\n          } else {\n            if (newRecords.length === 0) {\n              console.log('Stopping auto-load: No records received from API');\n            } else {\n              console.log(`All records loaded: Loaded ${uniqueRecordsCountRef.current} unique records from ${total} total records`);\n            }\n            setHasMore(false);\n          }\n        }\n        \n        if (response.data.warning && reset && !warningShownRef.current) {\n          warningShownRef.current = true;\n          toast(response.data.warning, {\n            duration: 8000,\n            icon: '⚠️',\n            style: {\n              background: '#fffbeb',\n              color: '#92400e',\n              border: '1px solid #fde68a'\n            }\n          });\n        }\n      } else {\n        toast.error(response.data.error || 'Failed to fetch approvals');\n        setHasMore(false);\n      }\n    } catch (error) {\n      console.error('Error fetching records:', error);\n      if (error.code !== 'ECONNREFUSED' && error.code !== 'ERR_NETWORK' && !error.isBackendDown) {\n        toast.error('Failed to fetch approvals');\n      }\n      setHasMore(false);\n    } finally {\n      setLoading(false);\n      setLoadingMore(false);\n      setRefreshing(false);\n      autoLoadingRef.current = false;\n    }\n  }, [filters, sortBy, sortOrder, offset]);\n\n  // Track if initial load has been done\n  const initialLoadDoneRef = useRef(false);\n  \n  // Initial load - only runs once on mount\n  useEffect(() => {\n    if (!initialLoadDoneRef.current) {\n      initialLoadDoneRef.current = true;\n      fetchDeadlines();\n      fetchFilterOptions();\n      fetchSummary(true);\n      fetchRecords(true);\n    }\n  }, [fetchDeadlines, fetchFilterOptions, fetchSummary, fetchRecords]);\n\n  // Note: Filters and sort changes no longer trigger data reset\n  // Data persists during the session and only reloads when refresh button is clicked\n\n  const handleRefresh = useCallback((e) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setRefreshing(true);\n    setOffset(0);\n    setRecords([]);\n    recordsRef.current = [];\n    setHasMore(true);\n    setSelectedRows([]);\n    setTotalRecords(0);\n    warningShownRef.current = false;\n    autoLoadingRef.current = false;\n    fetchRecords(true).finally(() => {\n      setRefreshing(false);\n    });\n    fetchSummary();\n    fetchFilterOptions();\n  }, [fetchRecords, fetchSummary, fetchFilterOptions]);\n\n  const handleFilterChange = (newFilters) => {\n    setFilters(newFilters);\n  };\n\n  const handleClearFilters = (clearedFilters) => {\n    setFilters(clearedFilters);\n  };\n\n  const handleSort = (column, order) => {\n    setSortBy(column);\n    setSortOrder(order);\n  };\n\n  const handleRowSelect = (recordId) => {\n    setSelectedRows(prev => {\n      if (prev.includes(recordId)) {\n        return prev.filter(id => id !== recordId);\n      } else {\n        return [...prev, recordId];\n      }\n    });\n  };\n\n  const handleApprove = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to approve');\n      return;\n    }\n    setShowApprovalModal(true);\n  };\n\n  const handleReject = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to reject');\n      return;\n    }\n    setShowRejectModal(true);\n  };\n\n  const handleSendEmail = () => {\n    if (selectedRows.length === 0) {\n      toast.error('Please select at least one record to email');\n      return;\n    }\n    setShowEmailModal(true);\n  };\n\n  const handleApprovalConfirm = async (comment) => {\n    try {\n      const response = await apiClient.post('/pm-approvals/approve', {\n        transactionIds: selectedRows,\n        comment: comment || ''\n      });\n      \n      if (response.data.success) {\n        toast.success(`Successfully approved ${response.data.approved} record(s)`);\n        setRecords(prev => {\n          const filtered = prev.filter(r => !selectedRows.includes(r.id));\n          // Update map to match filtered records\n          const newMap = new Map();\n          filtered.forEach(record => {\n            if (record && record.id) {\n              newMap.set(record.id, record);\n            }\n          });\n          recordsMapRef.current = newMap;\n          recordsRef.current = filtered;\n          return filtered;\n        });\n        setSelectedRows([]);\n        setShowApprovalModal(false);\n        fetchSummary();\n      } else {\n        toast.error(response.data.error || 'Failed to approve records');\n      }\n    } catch (error) {\n      toast.error(error.response?.data?.error || 'Failed to approve records');\n    }\n  };\n\n  const handleRejectConfirm = async (reason) => {\n    try {\n      const response = await apiClient.post('/pm-approvals/reject', {\n        transactionIds: selectedRows,\n        reason: reason || ''\n      });\n      \n      if (response.data.success) {\n        toast.success(`Successfully rejected ${response.data.rejected} record(s)`);\n        setRecords(prev => {\n          const filtered = prev.filter(r => !selectedRows.includes(r.id));\n          // Update map to match filtered records\n          const newMap = new Map();\n          filtered.forEach(record => {\n            if (record && record.id) {\n              newMap.set(record.id, record);\n            }\n          });\n          recordsMapRef.current = newMap;\n          recordsRef.current = filtered;\n          return filtered;\n        });\n        setSelectedRows([]);\n        setShowRejectModal(false);\n        fetchSummary();\n      } else {\n        toast.error(response.data.error || 'Failed to reject records');\n      }\n    } catch (error) {\n      toast.error(error.response?.data?.error || 'Failed to reject records');\n    }\n  };\n\n  const handleEmailConfirm = async (emailData) => {\n    toast.info('Email functionality coming soon');\n    setShowEmailModal(false);\n  };\n\n  return (\n    <div className=\"dashboard-layout\">\n      <Sidebar isOpen={sidebarOpen} toggleSidebar={() => setSidebarOpen(!sidebarOpen)} />\n      \n      <div \n        className=\"pm-approvals-page\" \n        style={{ \n          marginLeft: `${sidebarWidth}px`, \n          width: `calc(100% - ${sidebarWidth}px)`,\n          transition: 'margin-left 0.2s ease, width 0.2s ease'\n        }}\n      >\n        <div className=\"pm-approvals-container\">\n          {/* Header */}\n          <div className=\"pm-approvals-header\">\n            <div className=\"header-content\">\n              <div className=\"header-left\">\n                <button \n                  className=\"header-menu-toggle\"\n                  onClick={() => setSidebarOpen(!sidebarOpen)}\n                  aria-label=\"Toggle sidebar\"\n                >\n                  <Menu size={20} />\n                </button>\n                <div>\n                  <h1 className=\"page-title\">PM Approvals for Self Reported Time</h1>\n                </div>\n              </div>\n              <div className=\"header-right\">\n                <BookmarkButton />\n                <button\n                  className=\"refresh-btn\"\n                  onClick={handleRefresh}\n                  disabled={refreshing}\n                  title=\"Refresh\"\n                >\n                  <RefreshCw size={18} className={refreshing ? 'spinning' : ''} />\n                </button>\n                <div className=\"header-user-profile\">\n                  <div className=\"user-profile\">\n                    <div className=\"user-avatar\">\n                      {(user?.email || 'U').charAt(0).toUpperCase()}\n                    </div>\n                    <span className=\"user-name\">{user?.email || 'User'}</span>\n                    <button className=\"logout-btn\" onClick={logout} title=\"Logout\">\n                      <LogOut size={18} />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Main Content */}\n          <div className=\"pm-approvals-content\">\n            {/* Left Sidebar */}\n            <div className=\"pm-approvals-sidebar\">\n              <DeadlinesPanel deadlines={deadlines} loading={!deadlines} />\n              <RecordsCount \n                count={uniqueRecordsCount > 0 ? uniqueRecordsCount : records.length} \n                total={uniqueRecordsCount > 0 ? uniqueRecordsCount : records.length}\n                duplicates={duplicatesCount || 0}\n                loading={loading} \n                isLoadingMore={loadingMore || hasMore}\n              />\n              <FilterPanel\n                filters={filters}\n                onFilterChange={handleFilterChange}\n                onClearFilters={handleClearFilters}\n                filterOptions={filterOptions}\n                loading={loading}\n              />\n              <ActionButtons\n                onApprove={handleApprove}\n                onReject={handleReject}\n                onSendEmail={handleSendEmail}\n                disabled={loading}\n                selectedCount={selectedRows.length}\n              />\n            </div>\n\n            {/* Main Content Area */}\n            <div className=\"pm-approvals-main\" ref={tableContainerRef}>\n              {/* Summary Metrics */}\n              <div className=\"summary-metrics-section\">\n                <PendingHoursCard\n                  totalPendingHours={summary?.totalPendingHours || 0}\n                  totalHours={summary?.totalHours || 0}\n                />\n                <MetricsRow\n                  selfReportedTime={summary?.selfReportedTime || 0}\n                  systemTracked={summary?.systemTracked || 0}\n                  payment={summary?.totalPayment || 0}\n                />\n                <PendingUnitsCard\n                  totalPendingUnits={summary?.totalPendingUnits || 0}\n                />\n              </div>\n\n              {/* Table */}\n              <div className=\"approvals-table-section\">\n                <ApprovalsTable\n                  records={Array.isArray(records) ? records : []}\n                  loading={loading}\n                  onRowClick={(record) => console.log('Row clicked:', record)}\n                  onSort={handleSort}\n                  sortBy={sortBy}\n                  sortOrder={sortOrder}\n                  selectedRows={selectedRows}\n                  onRowSelect={handleRowSelect}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Modals */}\n      {showApprovalModal && (\n        <ApprovalModal\n          selectedCount={selectedRows.length}\n          onConfirm={handleApprovalConfirm}\n          onClose={() => setShowApprovalModal(false)}\n        />\n      )}\n      {showRejectModal && (\n        <RejectModal\n          selectedCount={selectedRows.length}\n          onConfirm={handleRejectConfirm}\n          onClose={() => setShowRejectModal(false)}\n        />\n      )}\n      {showEmailModal && (\n        <EmailModal\n          selectedCount={selectedRows.length}\n          onConfirm={handleEmailConfirm}\n          onClose={() => setShowEmailModal(false)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default PMApprovals;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}