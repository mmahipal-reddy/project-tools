import React, { useState } from 'react';
import { useAuth } from '../context/AuthContext';
import Sidebar from '../components/Sidebar';
import useSidebarWidth from '../hooks/useSidebarWidth';
import { Menu, LogOut } from 'lucide-react';
import CreateWorkStream from './CreateWorkStream';
import WorkStreamReporting from './WorkStreamReporting';
import WorkStreamAnalyticsDashboard from '../components/WorkStreamAnalytics/WorkStreamAnalyticsDashboard';
import '../styles/Sidebar.css';
import '../styles/GlobalHeader.css';
import '../styles/WorkstreamManagement.css';
import '../styles/CreateWorkStream.css';

const WorkstreamManagement = () => {
  const { user, logout } = useAuth();
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const sidebarWidth = useSidebarWidth(sidebarOpen);
  const [activeTab, setActiveTab] = useState('workstreams'); // 'workstreams', 'reporting', or 'analytics'

  return (
    <div className="dashboard-layout">
      <Sidebar isOpen={sidebarOpen} toggleSidebar={() => setSidebarOpen(!sidebarOpen)} />
      
      <div className="workstream-management" style={{ marginLeft: `${sidebarWidth}px`, width: `calc(100% - ${sidebarWidth}px)`, transition: 'margin-left 0.2s ease, width 0.2s ease' }}>
        <div className="workstream-management-container">
          {/* Header */}
          <div className="workstream-management-header">
            <div className="header-content">
              <div className="header-left">
                <button 
                  className="header-menu-toggle"
                  onClick={() => setSidebarOpen(!sidebarOpen)}
                  aria-label="Toggle sidebar"
                >
                  <Menu size={20} />
                </button>
                <div>
                  <h1 className="page-title">Workstream Management</h1>
                  <p className="page-subtitle">Create and manage workstreams</p>
                </div>
              </div>
              <div className="header-user-profile">
                <div className="user-profile">
                  <div className="user-avatar">
                    {(user?.email || 'U').charAt(0).toUpperCase()}
                  </div>
                  <span className="user-name">{user?.email || 'User'}</span>
                  <button className="logout-btn" onClick={logout} title="Logout">
                    <LogOut size={18} />
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Tabs */}
          <div style={{ display: 'flex', gap: '8px', marginBottom: '24px', borderBottom: '2px solid var(--border-color)' }}>
            <button
              onClick={() => setActiveTab('workstreams')}
              style={{
                padding: '12px 20px',
                background: 'none',
                border: 'none',
                borderBottom: activeTab === 'workstreams' ? '2px solid #0176d3' : '2px solid transparent',
                color: activeTab === 'workstreams' ? '#0176d3' : '#666',
                fontWeight: activeTab === 'workstreams' ? '600' : '400',
                cursor: 'pointer',
                fontSize: '14px',
                marginBottom: '-2px'
              }}
            >
              Workstreams
            </button>
            <button
              onClick={() => setActiveTab('reporting')}
              style={{
                padding: '12px 20px',
                background: 'none',
                border: 'none',
                borderBottom: activeTab === 'reporting' ? '2px solid #0176d3' : '2px solid transparent',
                color: activeTab === 'reporting' ? '#0176d3' : '#666',
                fontWeight: activeTab === 'reporting' ? '600' : '400',
                cursor: 'pointer',
                fontSize: '14px',
                marginBottom: '-2px'
              }}
            >
              Workstream Reporting
            </button>
            <button
              onClick={() => setActiveTab('analytics')}
              style={{
                padding: '12px 20px',
                background: 'none',
                border: 'none',
                borderBottom: activeTab === 'analytics' ? '2px solid #0176d3' : '2px solid transparent',
                color: activeTab === 'analytics' ? '#0176d3' : '#666',
                fontWeight: activeTab === 'analytics' ? '600' : '400',
                cursor: 'pointer',
                fontSize: '14px',
                marginBottom: '-2px'
              }}
            >
              Analytics
            </button>
          </div>

          {/* Tab Content */}
          <div className="workstream-management-content">
            {activeTab === 'workstreams' ? (
              <div className="tab-content-wrapper">
                <CreateWorkStream hideHeader={true} />
              </div>
            ) : activeTab === 'reporting' ? (
              <div className="tab-content-wrapper">
                <WorkStreamReporting hideHeader={true} />
              </div>
            ) : (
              <div className="tab-content-wrapper">
                <WorkStreamAnalyticsDashboard />
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default WorkstreamManagement;

